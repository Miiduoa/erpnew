<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ERPè¦åŠƒå¸«åˆ·é¡Œç³»çµ± - æ™ºèƒ½è¨˜æ†¶ç‰ˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-blue: #2563eb;
            --light-blue: #dbeafe;
            --success-green: #059669;
            --light-green: #d1fae5;
            --warning-orange: #d97706;
            --light-orange: #fed7aa;
            --error-red: #dc2626;
            --light-red: #fecaca;
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-600: #4b5563;
            --gray-800: #1f2937;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--light-blue) 0%, var(--gray-50) 100%);
            min-height: 100vh;
            color: var(--gray-800);
        }

        /* Header */
        .header {
            background: white;
            box-shadow: var(--shadow);
            padding: 1rem 0;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary-blue);
        }

        .stats {
            display: flex;
            gap: 2rem;
            font-size: 0.9rem;
        }

        .stat-item {
            text-align: center;
        }

        .stat-number {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--primary-blue);
        }

        /* Main Container */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem 1rem;
        }

        /* Navigation Tabs */
        .nav-tabs {
            display: flex;
            background: white;
            border-radius: 12px;
            padding: 0.5rem;
            margin-bottom: 2rem;
            box-shadow: var(--shadow);
            overflow-x: auto;
        }

        .nav-tab {
            flex: 1;
            padding: 0.75rem 1rem;
            text-align: center;
            background: transparent;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            white-space: nowrap;
            min-width: 100px;
        }

        .nav-tab.active {
            background: var(--primary-blue);
            color: white;
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .nav-tab:hover:not(.active) {
            background: var(--light-blue);
            transform: translateY(-1px);
        }

        /* Content Panels */
        .panel {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .panel.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Question Overview Panel */
        .overview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(60px, 1fr));
            gap: 0.5rem;
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: var(--shadow);
        }

        .question-number {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            font-size: 0.9rem;
            position: relative;
        }

        .question-number:hover {
            transform: scale(1.05);
            box-shadow: var(--shadow);
        }

        .question-number.unanswered {
            background: var(--gray-100);
            border: 2px solid var(--gray-200);
        }

        .question-number.correct {
            background: var(--success-green);
            color: white;
        }

        .question-number.incorrect {
            background: var(--error-red);
            color: white;
        }

        .question-number.current {
            background: var(--primary-blue);
            color: white;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* Question Panel */
        .question-card {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: var(--shadow);
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--gray-100);
            flex-wrap: wrap;
            gap: 1rem;
        }

        .question-info {
            display: flex;
            gap: 1rem;
            align-items: center;
            flex-wrap: wrap;
        }

        .question-badge {
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .question-badge.chapter {
            background: var(--light-blue);
            color: var(--primary-blue);
        }

        .question-badge.number {
            background: var(--primary-blue);
            color: white;
        }

        .question-text {
            font-size: 1.1rem;
            line-height: 1.6;
            margin-bottom: 2rem;
            color: var(--gray-800);
        }

        .options {
            display: grid;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .option {
            padding: 1rem 1.5rem;
            border: 2px solid var(--gray-200);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
            display: flex;
            align-items: center;
            font-size: 1rem;
        }

        .option:hover {
            border-color: var(--primary-blue);
            background: var(--light-blue);
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .option.selected {
            border-color: var(--primary-blue);
            background: var(--light-blue);
        }

        .option.correct {
            border-color: var(--success-green);
            background: var(--light-green);
        }

        .option.incorrect {
            border-color: var(--error-red);
            background: var(--light-red);
        }

        .option-letter {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--gray-100);
            margin-right: 1rem;
            font-weight: bold;
            flex-shrink: 0;
        }

        .option.selected .option-letter {
            background: var(--primary-blue);
            color: white;
        }

        .option.correct .option-letter {
            background: var(--success-green);
            color: white;
        }

        .option.incorrect .option-letter {
            background: var(--error-red);
            color: white;
        }

        /* Controls */
        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            font-size: 1rem;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        .btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .btn-primary {
            background: var(--primary-blue);
            color: white;
        }

        .btn-success {
            background: var(--success-green);
            color: white;
        }

        .btn-secondary {
            background: var(--gray-200);
            color: var(--gray-800);
        }

        .btn-error {
            background: var(--error-red);
            color: white;
        }

        .btn-warning {
            background: var(--warning-orange);
            color: white;
        }

        .question-selector {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .question-input {
            padding: 0.5rem;
            border: 2px solid var(--gray-200);
            border-radius: 6px;
            width: 80px;
            text-align: center;
            font-size: 1rem;
        }

        /* Progress Bar */
        .progress-container {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: var(--shadow);
            margin-bottom: 2rem;
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .progress-bar {
            height: 10px;
            background: var(--gray-200);
            border-radius: 5px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-blue), var(--success-green));
            transition: width 0.5s ease;
            border-radius: 5px;
        }

        /* Results Panel */
        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
        }

        .result-card {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: var(--shadow);
            text-align: center;
        }

        .result-number {
            font-size: 3rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .result-number.correct {
            color: var(--success-green);
        }

        .result-number.incorrect {
            color: var(--error-red);
        }

        .result-number.total {
            color: var(--primary-blue);
        }

        /* Browse Panel Styles */
        .browse-item {
            background: var(--gray-50);
            border: 1px solid var(--gray-200);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            transition: all 0.3s ease;
        }

        .browse-item:hover {
            background: white;
            border-color: var(--primary-blue);
            box-shadow: var(--shadow);
        }

        .browse-question-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .browse-question-number {
            background: var(--primary-blue);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9rem;
            flex-shrink: 0;
        }

        .browse-chapter {
            background: var(--light-blue);
            color: var(--primary-blue);
            padding: 0.25rem 0.75rem;
            border-radius: 15px;
            font-size: 0.8rem;
            flex-shrink: 0;
        }

        .browse-question-text {
            font-size: 1.1rem;
            line-height: 1.6;
            margin-bottom: 1rem;
            color: var(--gray-800);
        }

        .browse-options {
            margin-bottom: 1rem;
        }

        .browse-option {
            padding: 0.5rem 0;
            color: var(--gray-700);
            border-left: 3px solid transparent;
            padding-left: 1rem;
        }

        .browse-option.correct-answer {
            background: var(--light-green);
            border-left-color: var(--success-green);
            font-weight: 500;
            color: var(--success-green);
        }

        .browse-answer {
            background: var(--success-green);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9rem;
            display: inline-block;
        }

        .chapter-filter, #chapter-filter {
            padding: 0.5rem 1rem;
            border: 2px solid var(--gray-200);
            border-radius: 6px;
            background: white;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .chapter-filter:hover, #chapter-filter:hover {
            border-color: var(--primary-blue);
        }

        .chapter-filter:focus, #chapter-filter:focus {
            outline: none;
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.1);
        }

        /* File Upload Styles */
        .file-upload-area {
            border: 2px dashed var(--primary-blue);
            border-radius: 8px;
            padding: 2rem;
            text-align: center;
            background: var(--light-blue);
            transition: all 0.3s ease;
        }

        .file-upload-area:hover {
            border-color: var(--success-green);
            background: var(--light-green);
        }

        .file-upload-area input[type="file"] {
            margin: 1rem 0;
            padding: 0.5rem;
            border: 1px solid var(--gray-200);
            border-radius: 4px;
            background: white;
        }

        /* Memory Mode Styles */
        .memory-mode {
            display: none;
        }

        .memory-mode.active {
            display: block;
        }

        .memory-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .memory-stat-card {
            background: white;
            padding: 1.5rem;
            border-radius: 10px;
            text-align: center;
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
        }

        .memory-stat-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .memory-stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary-blue);
            margin-bottom: 0.5rem;
        }

        .memory-stat-label {
            font-size: 0.9rem;
            color: var(--gray-600);
        }

        .flashcard {
            max-width: 800px;
            margin: 0 auto;
            perspective: 1000px;
        }

        .flashcard-container {
            position: relative;
            min-height: 400px;
            transition: all 0.6s ease;
        }

        .flashcard-front, .flashcard-back {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            box-shadow: var(--shadow-lg);
            min-height: 400px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            position: absolute;
            width: 100%;
            top: 0;
            left: 0;
            transition: all 0.6s ease;
            backface-visibility: hidden;
        }

        .flashcard-front {
            background: linear-gradient(135deg, var(--light-blue) 0%, white 100%);
            z-index: 2;
        }

        .flashcard-back {
            background: linear-gradient(135deg, var(--light-green) 0%, white 100%);
            transform: rotateY(180deg);
            z-index: 1;
        }

        .flashcard-container.flipped .flashcard-front {
            transform: rotateY(-180deg);
            z-index: 1;
        }

        .flashcard-container.flipped .flashcard-back {
            transform: rotateY(0);
            z-index: 2;
        }

        .card-question-info {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .card-question-text {
            font-size: 1.2rem;
            line-height: 1.6;
            text-align: center;
            margin-bottom: 2rem;
            color: var(--gray-800);
            min-height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex: 1;
        }

        .card-answer-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .card-question-review {
            background: var(--light-blue);
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            border-left: 4px solid var(--primary-blue);
        }

        .card-question-review strong {
            color: var(--primary-blue);
        }

        .flip-btn {
            align-self: center;
            padding: 1rem 2rem;
            font-size: 1.1rem;
            border-radius: 25px;
        }

        .card-options {
            margin: 1.5rem 0;
        }

        .card-option {
            padding: 0.75rem 1rem;
            margin: 0.5rem 0;
            border-radius: 8px;
            background: var(--gray-50);
            border-left: 4px solid var(--gray-200);
            transition: all 0.3s ease;
        }

        .card-option.correct {
            background: var(--light-green);
            border-left-color: var(--success-green);
            color: var(--success-green);
            font-weight: 500;
        }

        .card-option.highlighted {
            background: var(--light-blue);
            border-left-color: var(--primary-blue);
            color: var(--primary-blue);
        }

        .difficulty-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--gray-200);
        }

        .difficulty-buttons .btn {
            padding: 1rem;
            border-radius: 10px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .btn-error:hover {
            background: #b91c1c;
        }

        .keyword-highlight {
            background: linear-gradient(120deg, #a8edea 0%, #fed6e3 100%);
            padding: 0.2rem 0.4rem;
            border-radius: 4px;
            font-weight: 600;
            margin: 0 0.1rem;
            border-bottom: 2px solid var(--primary-blue);
        }

        .memory-tip {
            background: var(--light-orange);
            border: 1px solid var(--warning-orange);
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            position: relative;
        }

        .memory-tip::before {
            content: "ğŸ’¡";
            position: absolute;
            top: -10px;
            left: 15px;
            background: white;
            padding: 0 0.5rem;
            font-size: 1.2rem;
        }

        .association-link {
            background: var(--light-blue);
            border-radius: 6px;
            padding: 0.5rem 1rem;
            margin: 0.5rem;
            display: inline-block;
            color: var(--primary-blue);
            border: 1px solid var(--primary-blue);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .association-link:hover {
            background: var(--primary-blue);
            color: white;
            transform: translateY(-1px);
        }

        .progress-ring {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: conic-gradient(var(--success-green) 0deg, var(--gray-200) 0deg);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: var(--gray-800);
            margin: 0 auto 1rem;
        }

        /* Wrong Questions Practice Styles */
        .wrong-practice-welcome {
            text-align: center;
            padding: 3rem 2rem;
        }

        .wrong-practice-welcome h3 {
            color: var(--primary-blue);
            margin-bottom: 1rem;
        }

        .continue-btn {
            margin-top: 1rem !important;
            margin-left: 0 !important;
        }

        .incorrect-question-item {
            border: 1px solid var(--gray-200);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            background: white;
            transition: all 0.3s ease;
        }

        .incorrect-question-item:hover {
            box-shadow: var(--shadow);
            border-color: var(--primary-blue);
        }

        .question-option-display {
            padding: 0.5rem;
            margin: 0.25rem 0;
            border-radius: 4px;
            transition: all 0.3s ease;
        }

        .question-option-correct {
            background: var(--light-green);
            border-left: 3px solid var(--success-green);
            color: var(--success-green);
        }

        .question-option-wrong {
            background: var(--light-red);
            border-left: 3px solid var(--error-red);
            color: var(--error-red);
        }

        .question-option-normal {
            background: var(--gray-50);
        }

        /* Notification System */
        .notification {
            position: fixed;
            top: 100px;
            right: 20px;
            padding: 1rem 2rem;
            border-radius: 8px;
            color: white;
            font-weight: bold;
            z-index: 1000;
            transform: translateX(400px);
            transition: all 0.3s ease;
            max-width: 300px;
            word-wrap: break-word;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            background: var(--success-green);
        }

        .notification.error {
            background: var(--error-red);
        }

        .notification.warning {
            background: var(--warning-orange);
        }

        .notification.info {
            background: var(--primary-blue);
        }

        /* Memory Status Indicator */
        .memory-status {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: var(--primary-blue);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.8rem;
            opacity: 0.6;
            z-index: 1000;
            transition: all 0.3s ease;
            transform: translateY(10px);
            cursor: help;
        }

        .memory-status:hover {
            opacity: 1 !important;
            transform: translateY(0) !important;
        }

        /* Loading Indicator */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid var(--gray-200);
            border-radius: 50%;
            border-top-color: var(--primary-blue);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }

            .stats {
                gap: 1rem;
                justify-content: center;
            }

            .nav-tabs {
                padding: 0.25rem;
                gap: 0.25rem;
            }

            .nav-tab {
                padding: 0.5rem 0.75rem;
                font-size: 0.9rem;
                min-width: 80px;
            }

            .overview-grid {
                grid-template-columns: repeat(auto-fill, minmax(50px, 1fr));
                gap: 0.3rem;
                padding: 1rem;
            }

            .question-card {
                padding: 1rem;
            }

            .question-header {
                flex-direction: column;
                align-items: flex-start;
                text-align: left;
            }

            .controls {
                flex-direction: column;
                align-items: stretch;
            }

            .question-selector {
                justify-content: center;
            }

            .browse-question-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.5rem;
            }

            .browse-item {
                padding: 1rem;
            }

            .chapter-filter, #chapter-filter, #memory-mode-select {
                width: 100%;
                margin-bottom: 1rem;
            }

            .memory-stats {
                grid-template-columns: repeat(2, 1fr);
                gap: 0.5rem;
            }

            .memory-stat-card {
                padding: 1rem;
            }

            .flashcard {
                max-width: 100%;
            }

            .flashcard-front, .flashcard-back {
                padding: 1.5rem;
                min-height: 350px;
            }

            .card-question-text {
                font-size: 1rem;
                min-height: 100px;
            }

            .difficulty-buttons {
                grid-template-columns: repeat(2, 1fr);
                gap: 0.5rem;
            }

            .difficulty-buttons .btn {
                padding: 0.75rem 0.5rem;
                font-size: 0.9rem;
            }

            .keyword-highlight {
                padding: 0.1rem 0.2rem;
                font-size: 0.9rem;
            }

            .association-link {
                padding: 0.4rem 0.8rem;
                margin: 0.25rem;
                font-size: 0.85rem;
            }

            .notification {
                right: 10px;
                left: 10px;
                max-width: none;
                transform: translateY(-100px);
            }

            .notification.show {
                transform: translateY(0);
            }

            .memory-status {
                left: 10px;
                right: 10px;
                text-align: center;
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 1rem 0.5rem;
            }

            .logo {
                font-size: 1.2rem;
            }

            .stats {
                flex-direction: column;
                gap: 0.5rem;
            }

            .stat-item {
                display: flex;
                justify-content: space-between;
                align-items: center;
                background: var(--light-blue);
                padding: 0.5rem 1rem;
                border-radius: 8px;
            }

            .question-text {
                font-size: 1rem;
            }

            .option {
                padding: 0.75rem 1rem;
                font-size: 0.95rem;
            }

            .btn {
                padding: 0.6rem 1rem;
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <div class="logo">ğŸ§  ERPè¦åŠƒå¸«åˆ·é¡Œç³»çµ± (æ™ºèƒ½è¨˜æ†¶ç‰ˆ)</div>
            <div class="stats">
                <div class="stat-item">
                    <div class="stat-number" id="correctCount">0</div>
                    <div>ç­”å°</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="incorrectCount">0</div>
                    <div>ç­”éŒ¯</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="totalAnswered">0</div>
                    <div>å·²ç­”</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="masteredCount">0</div>
                    <div>å·²æŒæ¡</div>
                </div>
            </div>
        </div>
    </header>

    <!-- è¨˜æ†¶ç‹€æ…‹æŒ‡ç¤ºå™¨ -->
    <div class="memory-status" id="memory-status" title="é»æ“ŠæŸ¥çœ‹è©³ç´°è¨˜æ†¶çµ±è¨ˆ">
        ğŸ’¾ è¨˜éŒ„å·²è‡ªå‹•ä¿å­˜
    </div>

    <div class="container">
        <nav class="nav-tabs">
            <button class="nav-tab active" onclick="showPanel('overview')">é¡Œåº«ç¸½è¦½</button>
            <button class="nav-tab" onclick="showPanel('practice')">é–‹å§‹åˆ·é¡Œ</button>
            <button class="nav-tab" onclick="showPanel('browse')">é¡Œåº«ç€è¦½</button>
            <button class="nav-tab" onclick="showPanel('memory')">è¨˜æ†¶æ¨¡å¼</button>
            <button class="nav-tab" onclick="showPanel('wrong')">éŒ¯é¡Œç·´ç¿’</button>
            <button class="nav-tab" onclick="showPanel('results')">ç­”é¡Œçµ±è¨ˆ</button>
            <button class="nav-tab" onclick="showPanel('debug')" id="debug-tab" style="display: none;">èª¿è©¦ä¿¡æ¯</button>
        </nav>

        <!-- é¡Œåº«ç¸½è¦½é¢æ¿ -->
        <div id="overview-panel" class="panel active">
            <!-- æ–‡ä»¶ä¸Šå‚³å€åŸŸ -->
            <div class="question-card" id="upload-section">
                <div class="question-header">
                    <h3>ğŸ“ é¡Œåº«æª”æ¡ˆä¸Šå‚³ (å‚™ç”¨é¸é …)</h3>
                </div>
                <div class="file-upload-area">
                    <div>ğŸ“„ ç³»çµ±å·²è‡ªå‹•å˜—è©¦è¼‰å…¥é¡Œåº«ï¼Œå¦‚éœ€æ‰‹å‹•ä¸Šå‚³è«‹é¸æ“‡CSVæ–‡ä»¶</div>
                    <input type="file" id="csv-file-upload" accept=".csv">
                    <div>
                        <button class="btn btn-primary" onclick="uploadCSVFile()">æ‰‹å‹•ä¸Šå‚³CSVé¡Œåº«æ–‡ä»¶</button>
                    </div>
                    <p style="margin-top: 1rem; color: var(--gray-600); font-size: 0.9rem;">
                        <strong>ç³»çµ±æ­£åœ¨è‡ªå‹•è¼‰å…¥å®Œæ•´é¡Œåº«</strong><br>
                        å¦‚æœè‡ªå‹•è¼‰å…¥å¤±æ•—ï¼Œå¯ä½¿ç”¨æ­¤åŠŸèƒ½æ‰‹å‹•ä¸Šå‚³ ERP_Questions.csv æ–‡ä»¶
                    </p>
                </div>
            </div>

            <div class="progress-container">
                <div class="progress-header">
                    <h3>ç­”é¡Œé€²åº¦</h3>
                    <span id="progress-text">0 / 0 (0%)</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill" style="width: 0%"></div>
                </div>
            </div>
            
            <div class="question-card">
                <div class="question-header">
                    <h3>é¡Œåº«ç¸½è¦½ (é»é¸é¡Œè™Ÿé–‹å§‹ä½œç­”)</h3>
                    <div class="question-info">
                        <span class="question-badge chapter" id="overview-stats">è¼‰å…¥ä¸­...</span>
                    </div>
                </div>
                <div class="overview-grid" id="overview-grid">
                    <!-- é¡Œç›®ç·¨è™Ÿå°‡ç”±JavaScriptç”Ÿæˆ -->
                </div>
            </div>
        </div>

        <!-- é¡Œåº«ç€è¦½é¢æ¿ -->
        <div id="browse-panel" class="panel">
            <div class="question-card">
                <div class="question-header">
                    <div class="question-info">
                        <h3>ğŸ“– é¡Œåº«ç€è¦½æ¨¡å¼</h3>
                        <span class="question-badge chapter" id="browse-filter">æ‰€æœ‰ç« ç¯€</span>
                    </div>
                    <div>
                        <select id="chapter-filter" onchange="filterByChapter()" class="btn btn-secondary">
                            <option value="">æ‰€æœ‰ç« ç¯€</option>
                        </select>
                    </div>
                </div>
                
                <div id="browse-container" style="max-height: 70vh; overflow-y: auto;">
                    <!-- é¡Œç›®ç€è¦½å…§å®¹å°‡ç”±JavaScriptç”Ÿæˆ -->
                </div>
            </div>
        </div>

        <!-- åˆ·é¡Œé¢æ¿ -->
        <div id="practice-panel" class="panel">
            <div class="question-card">
                <div class="question-header">
                    <div class="question-info">
                        <span class="question-badge number" id="current-question-badge">é¡Œç›® 1</span>
                        <span class="question-badge chapter" id="current-chapter-badge">è¼‰å…¥ä¸­...</span>
                    </div>
                    <div class="question-selector">
                        <button class="btn btn-secondary" onclick="goToRandomQuestion()" title="éš¨æ©Ÿè·³é¡Œ">ğŸ² éš¨æ©Ÿ</button>
                        <input type="number" class="question-input" id="question-input" min="1" max="500" placeholder="1">
                        <button class="btn btn-secondary" onclick="goToQuestion()">å‰å¾€</button>
                    </div>
                </div>
                
                <div class="question-text" id="question-text">è¼‰å…¥ä¸­...</div>
                
                <div class="options" id="options-container">
                    <!-- é¸é …å°‡ç”±JavaScriptç”Ÿæˆ -->
                </div>
                
                <div class="controls">
                    <div>
                        <button class="btn btn-secondary" onclick="previousQuestion()" id="prev-btn">â¬…ï¸ ä¸Šä¸€é¡Œ</button>
                        <button class="btn btn-primary" onclick="nextQuestion()" id="next-btn">ä¸‹ä¸€é¡Œ â¡ï¸</button>
                    </div>
                    
                    <div>
                        <button class="btn btn-success" onclick="submitAnswer()" id="submit-btn" style="display:none;">âœ… ç¢ºèªç­”æ¡ˆ</button>
                        <button class="btn btn-warning" onclick="markForReview()" id="review-btn" title="æ¨™è¨˜ç‚ºéœ€è¦å¾©ç¿’">â­ æ¨™è¨˜å¾©ç¿’</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- è¨˜æ†¶æ¨¡å¼é¢æ¿ -->
        <div id="memory-panel" class="panel">
            <div class="question-card">
                <div class="question-header">
                    <h3>ğŸ§  æ™ºèƒ½è¨˜æ†¶æ¨¡å¼</h3>
                    <div style="display: flex; gap: 1rem; align-items: center; flex-wrap: wrap;">
                        <select id="memory-mode-select" class="chapter-filter" onchange="changeMemoryMode()">
                            <option value="flashcard">è¨˜æ†¶å¡ç‰‡</option>
                            <option value="keyword">é—œéµè©è¨˜æ†¶</option>
                            <option value="association">è¯æƒ³è¨˜æ†¶</option>
                            <option value="spaced">é–“éš”é‡è¤‡</option>
                        </select>
                        <button class="btn btn-primary" onclick="startMemoryPractice()">ğŸš€ é–‹å§‹è¨˜æ†¶ç·´ç¿’</button>
                        <button class="btn btn-secondary" onclick="resetMemoryData()" title="é‡ç½®è¨˜æ†¶æ•¸æ“š">ğŸ”„ é‡ç½®è¨˜æ†¶</button>
                    </div>
                </div>
                
                <!-- è¨˜æ†¶å¡ç‰‡æ¨¡å¼ -->
                <div id="flashcard-mode" class="memory-mode active">
                    <div class="memory-stats">
                        <div class="memory-stat-card">
                            <div class="memory-stat-number" id="memory-total">0</div>
                            <div class="memory-stat-label">å¾…è¨˜æ†¶</div>
                        </div>
                        <div class="memory-stat-card">
                            <div class="memory-stat-number" style="color: var(--success-green);" id="memory-mastered">0</div>
                            <div class="memory-stat-label">å·²æŒæ¡</div>
                        </div>
                        <div class="memory-stat-card">
                            <div class="memory-stat-number" style="color: var(--warning-orange);" id="memory-learning">0</div>
                            <div class="memory-stat-label">å­¸ç¿’ä¸­</div>
                        </div>
                        <div class="memory-stat-card">
                            <div class="memory-stat-number" style="color: var(--error-red);" id="memory-difficult">0</div>
                            <div class="memory-stat-label">å›°é›£é¡Œ</div>
                        </div>
                    </div>
                    
                    <div id="flashcard-container">
                        <div class="flashcard" id="memory-card">
                            <div class="flashcard-container" id="flashcard-container-inner">
                                <div class="flashcard-front" id="card-front">
                                    <div>
                                        <div class="card-question-info">
                                            <span class="question-badge number" id="memory-question-badge">é¡Œç›® 1</span>
                                            <span class="question-badge chapter" id="memory-chapter-badge">è¼‰å…¥ä¸­...</span>
                                        </div>
                                        <div class="card-question-text" id="memory-question-text">é»æ“Šã€Œé–‹å§‹è¨˜æ†¶ç·´ç¿’ã€é–‹å§‹å­¸ç¿’</div>
                                    </div>
                                    <div style="text-align: center;">
                                        <button class="btn btn-primary flip-btn" onclick="flipCard()">ğŸ”„ é¡¯ç¤ºç­”æ¡ˆ</button>
                                        <div style="margin-top: 1rem; font-size: 0.8rem; color: var(--gray-600);">
                                            ğŸ’¡ å¿«æ·éµï¼šç©ºæ ¼ç¿»è½‰å¡ç‰‡ï¼Œæ•¸å­—éµ1-4é¸æ“‡é›£åº¦
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="flashcard-back" id="card-back">
                                    <div class="card-answer-section">
                                        <div>
                                            <div class="card-question-review" id="question-review">
                                                <strong>é¡Œç›®å›é¡§ï¼š</strong><span id="review-question-text">è¼‰å…¥ä¸­...</span>
                                            </div>
                                            <div class="card-question-text" id="memory-answer-text">ç­”æ¡ˆå’Œè§£æ</div>
                                            <div class="card-options" id="memory-card-options"></div>
                                        </div>
                                        
                                        <div>
                                            <div class="difficulty-buttons">
                                                <button class="btn btn-error" onclick="markDifficulty('hard')">ğŸ˜° å›°é›£ <br><small>(1) æ˜å¤©å¾©ç¿’</small></button>
                                                <button class="btn btn-warning" onclick="markDifficulty('medium')">ğŸ¤” ä¸€èˆ¬ <br><small>(2) 3å¤©å¾©ç¿’</small></button>
                                                <button class="btn btn-success" onclick="markDifficulty('easy')">ğŸ˜Š ç°¡å–® <br><small>(3) ä¸€é€±å¾©ç¿’</small></button>
                                                <button class="btn btn-primary" onclick="markDifficulty('mastered')">ğŸ¯ å·²æŒæ¡ <br><small>(4) ä¸€æœˆå¾©ç¿’</small></button>
                                            </div>
                                            <div style="text-align: center; margin-top: 1rem; font-size: 0.8rem; color: var(--gray-600);">
                                                å¿«æ·éµï¼šâ†’ä¸‹ä¸€å¼µï¼Œâ†è¿”å›é¡Œç›®ï¼ŒESCé€€å‡ºç·´ç¿’
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div style="text-align: center; margin-top: 2rem;">
                            <button class="btn btn-secondary" onclick="previousMemoryCard()" id="memory-prev-btn">â¬…ï¸ ä¸Šä¸€å¼µ</button>
                            <button class="btn btn-primary" onclick="nextMemoryCard()" id="memory-next-btn">ä¸‹ä¸€å¼µ â¡ï¸</button>
                            <button class="btn btn-warning" onclick="backToQuestion()" id="back-to-question-btn" style="display: none;">ğŸ“– è¿”å›æŸ¥çœ‹é¡Œç›®</button>
                            <button class="btn btn-secondary" onclick="exitMemoryPractice()" style="margin-left: 1rem;">ğŸšª é€€å‡ºç·´ç¿’</button>
                        </div>
                    </div>
                </div>
                
                <!-- é—œéµè©è¨˜æ†¶æ¨¡å¼ -->
                <div id="keyword-mode" class="memory-mode">
                    <div class="keyword-practice">
                        <div id="keyword-content">
                            <p style="text-align: center; padding: 2rem; color: var(--gray-600);">
                                é—œéµè©è¨˜æ†¶æ¨¡å¼å°‡è‡ªå‹•è­˜åˆ¥é¡Œç›®ä¸­çš„é‡è¦è©å½™ä¸¦é«˜äº®é¡¯ç¤ºï¼Œå¹«åŠ©ä½ å¿«é€Ÿè¨˜æ†¶æ ¸å¿ƒæ¦‚å¿µã€‚
                            </p>
                        </div>
                    </div>
                </div>
                
                <!-- è¯æƒ³è¨˜æ†¶æ¨¡å¼ -->
                <div id="association-mode" class="memory-mode">
                    <div class="association-practice">
                        <div id="association-content">
                            <p style="text-align: center; padding: 2rem; color: var(--gray-600);">
                                è¯æƒ³è¨˜æ†¶æ¨¡å¼å°‡ç‚ºä½ æä¾›æ¦‚å¿µé–“çš„é—œè¯æç¤ºï¼Œå»ºç«‹çŸ¥è­˜ç¶²è·¯ï¼Œå¢å¼·è¨˜æ†¶æ•ˆæœã€‚
                            </p>
                        </div>
                    </div>
                </div>
                
                <!-- é–“éš”é‡è¤‡æ¨¡å¼ -->
                <div id="spaced-mode" class="memory-mode">
                    <div class="spaced-practice">
                        <div id="spaced-content">
                            <div style="text-align: center; padding: 2rem;">
                                <h4 style="color: var(--primary-blue); margin-bottom: 1rem;">ğŸ“… é–“éš”é‡è¤‡å­¸ç¿’æ³•</h4>
                                <p style="color: var(--gray-600); margin-bottom: 2rem;">
                                    åŸºæ–¼è‰¾è³“æµ©æ–¯éºå¿˜æ›²ç·šï¼Œç³»çµ±æœƒåœ¨æœ€ä½³æ™‚æ©Ÿæé†’ä½ å¾©ç¿’ï¼Œæé«˜é•·æœŸè¨˜æ†¶æ•ˆæœã€‚
                                </p>
                                <div id="spaced-schedule" style="background: var(--gray-50); padding: 1.5rem; border-radius: 8px;">
                                    <h5 style="margin-bottom: 1rem;">ä»Šæ—¥å¾©ç¿’è¨ˆåŠƒ</h5>
                                    <div id="spaced-today-list">è¼‰å…¥ä¸­...</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- éŒ¯é¡Œç·´ç¿’é¢æ¿ -->
        <div id="wrong-panel" class="panel">
            <div class="question-card">
                <div class="question-header">
                    <div class="question-info">
                        <h3>âŒ éŒ¯é¡Œç·´ç¿’æ¨¡å¼</h3>
                        <span class="question-badge number" id="wrong-progress-badge">æº–å‚™ä¸­...</span>
                    </div>
                    <div>
                        <button class="btn btn-secondary" onclick="resetWrongQuestions()" style="margin-right: 1rem;">ğŸ”„ é‡ç½®éŒ¯é¡Œè¨˜éŒ„</button>
                        <button class="btn btn-primary" onclick="startWrongPractice()">ğŸš€ é–‹å§‹éŒ¯é¡Œç·´ç¿’</button>
                    </div>
                </div>
                
                <div id="wrong-practice-container">
                    <div id="wrong-welcome" style="text-align: center; padding: 3rem;">
                        <div style="font-size: 4rem; margin-bottom: 1rem;">ğŸ“š</div>
                        <h3 style="margin-bottom: 1rem;">éŒ¯é¡Œå°ˆé …ç·´ç¿’</h3>
                        <p style="color: var(--gray-600); margin-bottom: 2rem;">
                            å°ˆé–€ç·´ç¿’ç­”éŒ¯çš„é¡Œç›®ï¼Œéå›ºè–„å¼±çŸ¥è­˜é»<br>
                            <span id="wrong-count-text">è«‹å…ˆå®Œæˆä¸€äº›é¡Œç›®ä¾†å»ºç«‹éŒ¯é¡Œåº«</span>
                        </p>
                        <button class="btn btn-primary" onclick="startWrongPractice()">é–‹å§‹ç·´ç¿’</button>
                    </div>

                    <div id="wrong-practice-content" style="display: none;">
                        <!-- éŒ¯é¡Œç·´ç¿’çš„é¡Œç›®å…§å®¹ -->
                        <div class="question-header">
                            <div class="question-info">
                                <span class="question-badge number" id="wrong-current-badge">éŒ¯é¡Œ 1</span>
                                <span class="question-badge chapter" id="wrong-chapter-badge">è¼‰å…¥ä¸­...</span>
                            </div>
                            <div class="question-selector">
                                <span>éŒ¯é¡Œé€²åº¦ï¼š</span>
                                <span id="wrong-progress-text">0 / 0</span>
                            </div>
                        </div>
                        
                        <div class="question-text" id="wrong-question-text">è¼‰å…¥ä¸­...</div>
                        
                        <div class="options" id="wrong-options-container">
                            <!-- é¸é …å°‡ç”±JavaScriptç”Ÿæˆ -->
                        </div>
                        
                        <div class="controls">
                            <div>
                                <button class="btn btn-secondary" onclick="previousWrongQuestion()" id="wrong-prev-btn">â¬…ï¸ ä¸Šä¸€é¡Œ</button>
                                <button class="btn btn-primary" onclick="nextWrongQuestion()" id="wrong-next-btn">ä¸‹ä¸€é¡Œ â¡ï¸</button>
                            </div>
                            
                            <div>
                                <button class="btn btn-success" onclick="submitWrongAnswer()" id="wrong-submit-btn" style="display:none;">âœ… ç¢ºèªç­”æ¡ˆ</button>
                                <button class="btn btn-secondary" onclick="exitWrongPractice()">ğŸšª é€€å‡ºç·´ç¿’</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ç­”é¡Œçµ±è¨ˆé¢æ¿ -->
        <div id="results-panel" class="panel">
            <div class="results-grid">
                <div class="result-card">
                    <div class="result-number correct" id="result-correct">0</div>
                    <h4>ç­”å°é¡Œæ•¸</h4>
                </div>
                <div class="result-card">
                    <div class="result-number incorrect" id="result-incorrect">0</div>
                    <h4>ç­”éŒ¯é¡Œæ•¸</h4>
                </div>
                <div class="result-card">
                    <div class="result-number total" id="result-total">0</div>
                    <h4>ç¸½ç­”é¡Œæ•¸</h4>
                </div>
                <div class="result-card">
                    <div class="result-number" id="accuracy-rate" style="color: var(--warning-orange);">0%</div>
                    <h4>æ­£ç¢ºç‡</h4>
                </div>
            </div>

            <div class="question-card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; flex-wrap: wrap; gap: 1rem;">
                    <h3>ğŸ“Š å­¸ç¿’çµ±è¨ˆåˆ†æ</h3>
                    <div>
                        <button class="btn btn-warning" onclick="exportStudyData()" style="margin-right: 1rem;">ğŸ“¤ å°å‡ºå­¸ç¿’æ•¸æ“š</button>
                        <button class="btn btn-error" onclick="clearAllData()">ğŸ—‘ï¸ æ¸…é™¤æ‰€æœ‰è¨˜éŒ„</button>
                    </div>
                </div>
                
                <div id="study-analysis" style="margin-bottom: 2rem;">
                    <!-- å­¸ç¿’åˆ†æå…§å®¹ -->
                </div>
                
                <h4 style="margin-bottom: 1rem;">éŒ¯é¡Œå›é¡§</h4>
                <div id="incorrect-questions">
                    <p style="text-align: center; color: var(--gray-600); padding: 2rem;">
                        é‚„æ²’æœ‰éŒ¯é¡Œè¨˜éŒ„ï¼Œç¹¼çºŒåŠ æ²¹ï¼ ğŸ’ª
                    </p>
                </div>
            </div>
        </div>

        <!-- èª¿è©¦ä¿¡æ¯é¢æ¿ -->
        <div id="debug-panel" class="panel">
            <div class="question-card">
                <div class="question-header">
                    <h3>ğŸ”§ é¡Œåº«èª¿è©¦ä¿¡æ¯</h3>
                </div>
                <div id="debug-content">
                    <p style="text-align: center; color: var(--gray-600); padding: 2rem;">
                        è¼‰å…¥é¡Œåº«å¾Œå°‡é¡¯ç¤ºèª¿è©¦ä¿¡æ¯...
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // å…¨å±€è®Šé‡
        let questions = [];
        let currentQuestionIndex = 0;
        let userAnswers = {}; // å„²å­˜ç”¨æˆ¶ç­”æ¡ˆ
        let showingAnswer = false;
        
        // éŒ¯é¡Œç·´ç¿’ç›¸é—œ
        let wrongQuestions = [];
        let currentWrongIndex = 0;
        let wrongAnswers = {};
        let showingWrongAnswer = false;

        // è¨˜æ†¶åŠŸèƒ½ç›¸é—œ
        let memoryData = {};
        let currentMemoryIndex = 0;
        let memoryQuestions = [];
        let currentMemoryMode = 'flashcard';
        let isCardFlipped = false;
        let isMemoryPracticing = false;

        // æ•¸æ“šæŒä¹…åŒ–éµå€¼
        const STORAGE_KEYS = {
            USER_ANSWERS: 'erp_user_answers',
            WRONG_ANSWERS: 'erp_wrong_answers', 
            LAST_QUESTION: 'erp_last_question',
            LAST_WRONG_QUESTION: 'erp_last_wrong_question',
            MEMORY_DATA: 'erp_memory_data',
            MARKED_FOR_REVIEW: 'erp_marked_for_review'
        };

        // è¨˜æ†¶ç®—æ³•é…ç½®
        const DIFFICULTY_INTERVALS = {
            'hard': 1,      // 1å¤©å¾Œå¾©ç¿’
            'medium': 3,    // 3å¤©å¾Œå¾©ç¿’  
            'easy': 7,      // 7å¤©å¾Œå¾©ç¿’
            'mastered': 30  // 30å¤©å¾Œå¾©ç¿’
        };

        // ERPé—œéµè©åº«
        const ERP_KEYWORDS = [
            'ERP', 'ä¼æ¥­è³‡æºè¦åŠƒ', 'éŠ·å”®', 'é…éŠ·', 'æ¡è³¼', 'åº«å­˜', 'ç”Ÿç”¢', 'è²¡å‹™', 'äººåŠ›è³‡æº',
            'æ¨¡çµ„', 'ç³»çµ±', 'æµç¨‹', 'ç®¡ç†', 'æ§åˆ¶', 'è¦åŠƒ', 'è¨‚å–®', 'å®¢æˆ¶', 'ä¾›æ‡‰å•†',
            'è³‡æ–™åº«', 'æ•´åˆ', 'å³æ™‚', 'æˆæœ¬', 'é ç®—', 'åˆ†æ', 'å ±è¡¨', 'ä½œæ¥­', 'æ•ˆç‡',
            'Make to Order', 'Make to Stock', 'MRP', 'BOM', 'ATP', 'EOQ', 'ABCåˆ†æ',
            'ä¸»ç”Ÿç”¢æ’ç¨‹', 'ç‰©æ–™éœ€æ±‚è¦åŠƒ', 'å·¥ä½œä¸­å¿ƒ', 'é€”ç¨‹', 'å“è³ª', 'å®‰å…¨å­˜é‡'
        ];

        // é€šçŸ¥ç³»çµ±
        let notificationContainer;

        // ===== åˆå§‹åŒ–å‡½æ•¸ =====
        async function init() {
            try {
                // å‰µå»ºé€šçŸ¥å®¹å™¨
                createNotificationContainer();
                
                // é¡¯ç¤ºè¼‰å…¥æç¤º
                document.getElementById('question-text').textContent = 'æ­£åœ¨è¼‰å…¥ERPé¡Œåº«ï¼Œè«‹ç¨å€™...';
                showNotification('æ­£åœ¨è¼‰å…¥é¡Œåº«...', 'info');
                
                // è¼‰å…¥é¡Œç›®æ•¸æ“š
                await loadQuestions();
                
                if (questions.length === 0) {
                    document.getElementById('question-text').textContent = 'è¼‰å…¥å¤±æ•—ï¼Œè«‹é‡æ–°æ•´ç†é é¢æˆ–æ‰‹å‹•ä¸Šå‚³CSVæ–‡ä»¶ã€‚';
                    showNotification('é¡Œåº«è¼‰å…¥å¤±æ•—ï¼', 'error');
                    return;
                }
                
                // è¼‰å…¥ä¿å­˜çš„æ•¸æ“š
                loadSavedData();
                loadMemoryData();
                
                // åˆå§‹åŒ–æ‰€æœ‰åŠŸèƒ½
                generateOverview();
                generateBrowseContent();
                generateChapterFilter();
                showQuestion(currentQuestionIndex);
                updateStats();
                updateResults();
                updateWrongQuestionsDisplay();
                updateMemoryStats();
                
                // æª¢æŸ¥é¡Œç›®è³ªé‡
                checkQuestionQuality();
                
                // æ ¹æ“šè¼‰å…¥çµæœé¡¯ç¤ºç›¸æ‡‰æç¤º
                handleLoadingResult();
                
                // ç¶å®šäº‹ä»¶ç›£è½å™¨
                bindEventListeners();
                
                console.log('ç³»çµ±åˆå§‹åŒ–å®Œæˆ');
                
            } catch (error) {
                console.error('åˆå§‹åŒ–å¤±æ•—:', error);
                showNotification('ç³»çµ±åˆå§‹åŒ–å¤±æ•—ï¼', 'error');
            }
        }

        // ===== æ•¸æ“šè¼‰å…¥å‡½æ•¸ =====
        async function loadQuestions() {
            try {
                // é¦–å…ˆå˜—è©¦å¾åŒç›®éŒ„è®€å–CSVæ–‡ä»¶
                console.log('å˜—è©¦è¼‰å…¥CSVæ–‡ä»¶...');
                const response = await fetch('./ERP_Questions.csv');
                
                if (response.ok) {
                    const csvContent = await response.text();
                    console.log('æˆåŠŸè®€å–CSVæ–‡ä»¶');
                    parseCSVContent(csvContent);
                    
                    if (questions.length > 0) {
                        console.log(`å¾CSVæˆåŠŸè¼‰å…¥ ${questions.length} é“é¡Œç›®`);
                        return;
                    }
                }
                
                // å¦‚æœfetchå¤±æ•—ï¼Œå˜—è©¦ä½¿ç”¨æ–‡ä»¶ç³»çµ±API
                if (window.fs && window.fs.readFile) {
                    console.log('å˜—è©¦ä½¿ç”¨æ–‡ä»¶ç³»çµ±API...');
                    const csvContent = await window.fs.readFile('ERP_Questions.csv', { encoding: 'utf8' });
                    parseCSVContent(csvContent);
                    if (questions.length > 0) {
                        console.log(`å¾æ–‡ä»¶ç³»çµ±æˆåŠŸè¼‰å…¥ ${questions.length} é“é¡Œç›®`);
                        return;
                    }
                }
                
            } catch (error) {
                console.log('è‡ªå‹•è¼‰å…¥å¤±æ•—ï¼Œå°‡ä½¿ç”¨æ¼”ç¤ºæ¨¡å¼:', error.message);
            }
            
            // å¦‚æœæ‰€æœ‰è‡ªå‹•è¼‰å…¥æ–¹å¼éƒ½å¤±æ•—ï¼Œè¼‰å…¥æ¼”ç¤ºé¡Œç›®
            loadSampleQuestions();
        }

        // è§£æCSVå…§å®¹ - å„ªåŒ–ç‰ˆ
        function parseCSVContent(csvContent) {
            console.log('é–‹å§‹è§£æCSVå…§å®¹...');
            const lines = csvContent.split('\n').map(line => line.trim()).filter(line => line && line !== 'Content');
            console.log(`CSVç¸½è¡Œæ•¸: ${lines.length}`);
            
            let currentChapter = "";
            const questionLines = [];
            
            // æ‰¾åˆ°æ‰€æœ‰é¡Œç›®è¡Œ - æ›´ç²¾ç¢ºçš„æ­£å‰‡è¡¨é”å¼
            lines.forEach((line, index) => {
                const match = line.match(/^\(([A-D])\)\s*(\d+)\.\s*(.+)/);
                if (match) {
                    const answer = match[1];
                    const questionId = parseInt(match[2]);
                    const questionText = match[3];
                    
                    if (questionId >= 1 && questionId <= 500) {
                        questionLines.push({
                            lineIndex: index,
                            questionId: questionId,
                            answer: answer,
                            questionText: questionText,
                            fullLine: line
                        });
                    }
                }
            });
            
            console.log(`æ‰¾åˆ° ${questionLines.length} é“é¡Œç›®è¡Œ`);
            
            // æŒ‰é¡Œç›®IDæ’åº
            questionLines.sort((a, b) => a.questionId - b.questionId);
            
            // ç‚ºæ¯é“é¡Œç›®æ”¶é›†é¸é …å’Œç« ç¯€ä¿¡æ¯
            let processedCount = 0;
            for (let i = 0; i < questionLines.length; i++) {
                const currentQ = questionLines[i];
                const nextQ = questionLines[i + 1];
                
                let questionText = currentQ.questionText;
                let options = [];
                
                // åœ¨ç•¶å‰é¡Œç›®ä¹‹å‰æŸ¥æ‰¾ç« ç¯€ä¿¡æ¯
                for (let k = currentQ.lineIndex - 1; k >= 0; k--) {
                    const prevLine = lines[k];
                    if (prevLine.includes("ç¬¬") && prevLine.includes("ç« ")) {
                        currentChapter = prevLine.replace(/\d+ä¸­è¯ä¼æ¥­è³‡æºè¦åŠƒå­¸æœƒ å°ˆæ¥­èªè­‰/, '').trim();
                        break;
                    }
                    if (k === 0 || lines[k].match(/^\([A-D]\)\s*\d+\./)) {
                        break;
                    }
                }
                
                // æ”¶é›†é¸é … - å„ªåŒ–é‚è¼¯
                const startIndex = currentQ.lineIndex + 1;
                const endIndex = nextQ ? nextQ.lineIndex : lines.length;
                
                for (let j = startIndex; j < endIndex; j++) {
                    let line = lines[j];
                    
                    // è·³éæ¨™é¡Œè¡Œå’Œç« ç¯€è¡Œ
                    if (line.includes("ERP è¦åŠƒå¸«") || 
                        line.includes("è©¦ é¡Œ æŒ‡ å—") || 
                        line.includes("ERPè¦åŠƒå¸«-åƒè€ƒé¡Œå‹") ||
                        line.includes("ä¸­è¯ä¼æ¥­è³‡æºè¦åŠƒå­¸æœƒ") ||
                        (line.includes("ç¬¬") && line.includes("ç« "))) {
                        continue;
                    }
                    
                    // æ¸…ç†é›™å¼•è™Ÿ
                    if (line.startsWith('"') && line.endsWith('"')) {
                        line = line.slice(1, -1);
                    }
                    
                    // æª¢æŸ¥æ˜¯å¦ç‚ºé¸é …è¡Œ
                    const isOptionLine = line.match(/^\([A-D]\)/);
                    const isQuestionLine = line.match(/^\([A-D]\)\s*\d+\./);
                    
                    if (isOptionLine && !isQuestionLine) {
                        options.push(line);
                    } else if (isQuestionLine) {
                        break;
                    } else if (options.length === 0 && line.trim()) {
                        questionText += " " + line;
                    }
                    
                    if (options.length >= 8) break;
                }
                
                // å‰µå»ºé¡Œç›®å°è±¡
                questions.push({
                    id: currentQ.questionId,
                    question: questionText.trim(),
                    answer: currentQ.answer,
                    options: options,
                    chapter: currentChapter || "ç¬¬ 1 ç«  ä¼æ¥­è³‡æºè¦åŠƒç°¡ä»‹"
                });
                
                processedCount++;
            }
            
            // æŒ‰é¡Œç›®ç·¨è™Ÿæ’åº
            questions.sort((a, b) => a.id - b.id);
            console.log(`CSVè§£æå®Œæˆï¼ŒæˆåŠŸè™•ç† ${processedCount} é“é¡Œç›®`);
        }

        // è¼‰å…¥ç¤ºä¾‹é¡Œç›®
        function loadSampleQuestions() {
            questions = [
                {
                    id: 1,
                    question: "ERP ç³»çµ±æœ€æ–°çš„ä¸»æµè¶¨å‹¢æ˜¯æ¡ç”¨ä¸‹åˆ—å“ªä¸€ç¨®åŸºæœ¬æŠ€è¡“æ¶æ§‹",
                    answer: "D",
                    options: [
                        "(A) é›†ä¸­å¼æ¶æ§‹",
                        "(B) åˆ†æ•£å¼æ¶æ§‹", 
                        "(C) åŒå„•è¨ˆç®—æ¶æ§‹",
                        "(D) å¤šå±¤å¼(Multi-tier)ä¸»å¾æ¶æ§‹"
                    ],
                    chapter: "ç¬¬ 1 ç«  ä¼æ¥­è³‡æºè¦åŠƒç°¡ä»‹"
                },
                {
                    id: 2,
                    question: "ERP ç³»çµ±èƒ½å³æ™‚æ•´åˆå„æµç¨‹è³‡æ–™çš„åŸå› ç‚º",
                    answer: "A",
                    options: [
                        "(A) å„æµç¨‹è³‡æ–™å„²å­˜æ–¼åŒä¸€è³‡æ–™åº«ä¸­",
                        "(B) å¿«é€Ÿçš„é›»è…¦é‹ç®—",
                        "(C) é›»å­å•†å‹™çš„ç››è¡Œ", 
                        "(D) æ”¿åºœé¼“å‹µ"
                    ],
                    chapter: "ç¬¬ 1 ç«  ä¼æ¥­è³‡æºè¦åŠƒç°¡ä»‹"
                },
                // ... æ›´å¤šç¤ºä¾‹é¡Œç›®
            ];
            console.log(`è¼‰å…¥äº† ${questions.length} é“ç¤ºä¾‹é¡Œç›®ï¼ˆæ¼”ç¤ºæ¨¡å¼ï¼‰`);
        }

        // ===== æ•¸æ“šç®¡ç†å‡½æ•¸ =====
        function saveToStorage(key, data) {
            try {
                localStorage.setItem(key, JSON.stringify(data));
                return true;
            } catch (error) {
                console.error('ä¿å­˜æ•¸æ“šå¤±æ•—:', error);
                return false;
            }
        }

        function loadFromStorage(key, defaultValue = null) {
            try {
                const data = localStorage.getItem(key);
                return data ? JSON.parse(data) : defaultValue;
            } catch (error) {
                console.error('è®€å–æ•¸æ“šå¤±æ•—:', error);
                return defaultValue;
            }
        }

        function loadSavedData() {
            userAnswers = loadFromStorage(STORAGE_KEYS.USER_ANSWERS, {});
            wrongAnswers = loadFromStorage(STORAGE_KEYS.WRONG_ANSWERS, {});
            const lastQuestion = loadFromStorage(STORAGE_KEYS.LAST_QUESTION, 0);
            const lastWrongQuestion = loadFromStorage(STORAGE_KEYS.LAST_WRONG_QUESTION, 0);
            
            currentQuestionIndex = Math.max(0, Math.min(lastQuestion, questions.length - 1));
            currentWrongIndex = Math.max(0, lastWrongQuestion);
            
            console.log(`è¼‰å…¥ä¿å­˜çš„æ•¸æ“š: ${Object.keys(userAnswers).length} å€‹ç­”é¡Œè¨˜éŒ„`);
        }

        function loadMemoryData() {
            memoryData = loadFromStorage(STORAGE_KEYS.MEMORY_DATA, {});
            console.log(`è¼‰å…¥è¨˜æ†¶æ•¸æ“š: ${Object.keys(memoryData).length} å€‹é¡Œç›®è¨˜éŒ„`);
        }

        function saveAnswers() {
            if (saveToStorage(STORAGE_KEYS.USER_ANSWERS, userAnswers) && 
                saveToStorage(STORAGE_KEYS.LAST_QUESTION, currentQuestionIndex)) {
                showMemoryStatus('ç­”é¡Œè¨˜éŒ„å·²ä¿å­˜');
            }
        }

        function saveMemoryData() {
            if (saveToStorage(STORAGE_KEYS.MEMORY_DATA, memoryData)) {
                showMemoryStatus('è¨˜æ†¶æ•¸æ“šå·²ä¿å­˜');
            }
        }

        function saveWrongAnswers() {
            if (saveToStorage(STORAGE_KEYS.WRONG_ANSWERS, wrongAnswers) && 
                saveToStorage(STORAGE_KEYS.LAST_WRONG_QUESTION, currentWrongIndex)) {
                showMemoryStatus('éŒ¯é¡Œè¨˜éŒ„å·²ä¿å­˜');
            }
        }

        // ===== ç•Œé¢æ›´æ–°å‡½æ•¸ =====
        function generateOverview() {
            const grid = document.getElementById('overview-grid');
            grid.innerHTML = '';
            
            // æ›´æ–°çµ±è¨ˆä¿¡æ¯
            const totalQuestions = questions.length;
            const answeredCount = Object.keys(userAnswers).length;
            const correctCount = Object.entries(userAnswers).filter(([id, answer]) => {
                const question = questions.find(q => q.id == id);
                return question && question.answer === answer;
            }).length;
            
            document.getElementById('overview-stats').textContent = 
                `ç¸½é¡Œæ•¸ï¼š${totalQuestions}ï¼Œå·²ç­”ï¼š${answeredCount}ï¼Œæ­£ç¢ºï¼š${correctCount}`;
            
            // æ›´æ–°è¼¸å…¥æ¡†æœ€å¤§å€¼
            const questionInput = document.getElementById('question-input');
            if (questions.length > 0) {
                const maxId = Math.max(...questions.map(q => q.id));
                questionInput.max = maxId;
            }
            
            // ç”Ÿæˆé¡Œç›®ç¶²æ ¼
            questions.forEach(q => {
                const numberEl = document.createElement('div');
                numberEl.className = 'question-number unanswered';
                numberEl.textContent = q.id;
                numberEl.onclick = () => {
                    currentQuestionIndex = questions.findIndex(question => question.id === q.id);
                    showPanel('practice');
                    showQuestion(currentQuestionIndex);
                };
                
                // è¨­ç½®é¡Œç›®ç‹€æ…‹
                if (userAnswers[q.id]) {
                    if (userAnswers[q.id] === q.answer) {
                        numberEl.className = 'question-number correct';
                    } else {
                        numberEl.className = 'question-number incorrect';
                    }
                }
                
                // æ·»åŠ é¡Œç›®ä¿¡æ¯æç¤º
                numberEl.title = `é¡Œç›® ${q.id}: ${q.chapter}\n${q.question.slice(0, 50)}...`;
                
                grid.appendChild(numberEl);
            });
        }

        function showQuestion(index) {
            if (index < 0 || index >= questions.length) return;
            
            currentQuestionIndex = index;
            const question = questions[index];
            showingAnswer = false;
            
            // æ›´æ–°é¡Œç›®ä¿¡æ¯
            document.getElementById('current-question-badge').textContent = `é¡Œç›® ${question.id}`;
            document.getElementById('current-chapter-badge').textContent = question.chapter;
            document.getElementById('question-text').textContent = question.question;
            document.getElementById('question-input').value = question.id;
            
            // ç”Ÿæˆé¸é …
            const optionsContainer = document.getElementById('options-container');
            optionsContainer.innerHTML = '';
            
            if (question.options && question.options.length > 0) {
                question.options.forEach((option, i) => {
                    const optionEl = document.createElement('div');
                    optionEl.className = 'option';
                    
                    const letterMatch = option.match(/^\(([A-D])\)/);
                    if (letterMatch) {
                        const letter = letterMatch[1];
                        const text = option.replace(/^\([A-D]\)\s*/, '');
                        
                        optionEl.innerHTML = `
                            <div class="option-letter">${letter}</div>
                            <div>${text}</div>
                        `;
                        
                        optionEl.onclick = () => selectOption(letter, optionEl);
                    } else {
                        optionEl.innerHTML = `
                            <div class="option-letter">?</div>
                            <div>${option}</div>
                        `;
                    }
                    
                    optionsContainer.appendChild(optionEl);
                });
            } else {
                optionsContainer.innerHTML = `
                    <div style="text-align: center; padding: 2rem; color: var(--error-red);">
                        âš ï¸ æ­¤é¡Œç›®é¸é …è§£æå¤±æ•—ï¼Œè«‹æª¢æŸ¥åŸå§‹æ•¸æ“šæ ¼å¼
                    </div>
                `;
            }
            
            // å¦‚æœå·²ç¶“ç­”éï¼Œé¡¯ç¤ºä¹‹å‰çš„é¸æ“‡
            if (userAnswers[question.id]) {
                const selectedOption = optionsContainer.querySelector(`[onclick*="${userAnswers[question.id]}"]`);
                if (selectedOption) {
                    selectedOption.classList.add('selected');
                }
            }
            
            // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
            updateButtonStates();
            updateOverviewHighlight();
            saveAnswers(); // ä¿å­˜ç•¶å‰ä½ç½®
        }

        function updateStats() {
            const answered = Object.keys(userAnswers).length;
            const correct = Object.entries(userAnswers).filter(([id, answer]) => {
                const question = questions.find(q => q.id == id);
                return question && question.answer === answer;
            }).length;
            const incorrect = answered - correct;
            const mastered = Object.values(memoryData).filter(data => 
                data.difficulty === 'mastered').length;
            
            document.getElementById('correctCount').textContent = correct;
            document.getElementById('incorrectCount').textContent = incorrect;
            document.getElementById('totalAnswered').textContent = answered;
            document.getElementById('masteredCount').textContent = mastered;
            
            // æ›´æ–°é€²åº¦æ¢
            const totalQuestions = questions.length;
            const progressPercent = totalQuestions > 0 ? (answered / totalQuestions) * 100 : 0;
            document.getElementById('progress-fill').style.width = `${progressPercent}%`;
            document.getElementById('progress-text').textContent = 
                `${answered} / ${totalQuestions} (${Math.round(progressPercent)}%)`;
        }

        // ===== è¨˜æ†¶æ¨¡å¼å‡½æ•¸ =====
        function changeMemoryMode() {
            const mode = document.getElementById('memory-mode-select').value;
            currentMemoryMode = mode;
            
            // éš±è—æ‰€æœ‰æ¨¡å¼
            document.querySelectorAll('.memory-mode').forEach(modeEl => {
                modeEl.classList.remove('active');
            });
            
            // é¡¯ç¤ºé¸ä¸­çš„æ¨¡å¼
            document.getElementById(`${mode}-mode`).classList.add('active');
            
            // åˆå§‹åŒ–æ¨¡å¼
            if (mode === 'flashcard') {
                updateMemoryStats();
            }
        }

        function startMemoryPractice() {
            if (questions.length === 0) {
                showNotification('è«‹å…ˆè¼‰å…¥é¡Œåº«ï¼', 'error');
                return;
            }
            
            prepareMemoryQuestions();
            
            if (memoryQuestions.length === 0) {
                showNotification('æ‰€æœ‰é¡Œç›®éƒ½å·²æŒæ¡ï¼ğŸ‰', 'success');
                return;
            }
            
            isMemoryPracticing = true;
            currentMemoryIndex = 0;
            showMemoryCard(currentMemoryIndex);
            updateMemoryStats();
            showNotification(`é–‹å§‹è¨˜æ†¶ç·´ç¿’ï¼Œå…± ${memoryQuestions.length} é“é¡Œç›®`, 'success');
        }

        function prepareMemoryQuestions() {
            const today = new Date().toDateString();
            
            memoryQuestions = questions.filter(q => {
                const memoryInfo = memoryData[q.id];
                if (!memoryInfo) return true; // æ–°é¡Œç›®
                if (memoryInfo.difficulty === 'mastered' && memoryInfo.nextReview > today) return false;
                return memoryInfo.nextReview <= today;
            });
            
            // æŒ‰é›£åº¦æ’åºï¼šå›°é›£çš„å„ªå…ˆ
            memoryQuestions.sort((a, b) => {
                const difficultyOrder = {'hard': 0, 'medium': 1, 'easy': 2, 'mastered': 3};
                const aDiff = memoryData[a.id]?.difficulty || 'medium';
                const bDiff = memoryData[b.id]?.difficulty || 'medium';
                return difficultyOrder[aDiff] - difficultyOrder[bDiff];
            });
        }

        function showMemoryCard(index) {
            if (index < 0 || index >= memoryQuestions.length) return;
            
            const question = memoryQuestions[index];
            isCardFlipped = false;
            
            // é‡ç½®å¡ç‰‡ç‹€æ…‹
            document.getElementById('flashcard-container-inner').classList.remove('flipped');
            document.getElementById('back-to-question-btn').style.display = 'none';
            
            // æ›´æ–°å¡ç‰‡å…§å®¹
            document.getElementById('memory-question-badge').textContent = `é¡Œç›® ${question.id}`;
            document.getElementById('memory-chapter-badge').textContent = question.chapter;
            
            // æ ¹æ“šæ¨¡å¼é¡¯ç¤ºé¡Œç›®
            if (currentMemoryMode === 'keyword') {
                document.getElementById('memory-question-text').innerHTML = highlightKeywords(question.question);
            } else {
                document.getElementById('memory-question-text').textContent = question.question;
            }
            
            // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
            updateMemoryButtonStates();
        }

        function flipCard() {
            if (memoryQuestions.length === 0) return;
            
            const question = memoryQuestions[currentMemoryIndex];
            const container = document.getElementById('flashcard-container-inner');
            
            isCardFlipped = !isCardFlipped;
            
            if (isCardFlipped) {
                // ç¿»è½‰åˆ°èƒŒé¢
                container.classList.add('flipped');
                document.getElementById('back-to-question-btn').style.display = 'inline-block';
                
                // æ›´æ–°ç­”æ¡ˆå…§å®¹
                document.getElementById('review-question-text').textContent = question.question;
                document.getElementById('memory-answer-text').innerHTML = 
                    `<strong>æ­£ç¢ºç­”æ¡ˆï¼š${question.answer}</strong><br><br>${generateMemoryTip(question)}`;
                
                // é¡¯ç¤ºé¸é …
                const optionsHtml = question.options.map(option => {
                    const letterMatch = option.match(/^\(([A-D])\)/);
                    if (!letterMatch) return '';
                    
                    const letter = letterMatch[1];
                    const text = option.replace(/^\([A-D]\)\s*/, '');
                    const isCorrect = letter === question.answer;
                    
                    return `
                        <div class="card-option ${isCorrect ? 'correct' : ''}">
                            <strong>${letter})</strong> ${text}
                            ${isCorrect ? ' âœ“' : ''}
                        </div>
                    `;
                }).join('');
                
                document.getElementById('memory-card-options').innerHTML = optionsHtml;
            } else {
                // ç¿»è½‰åˆ°æ­£é¢
                container.classList.remove('flipped');
                document.getElementById('back-to-question-btn').style.display = 'none';
            }
        }

        function backToQuestion() {
            if (!isCardFlipped) return;
            flipCard();
        }

        function markDifficulty(difficulty) {
            if (memoryQuestions.length === 0) return;
            
            const question = memoryQuestions[currentMemoryIndex];
            const today = new Date();
            const nextReviewDate = new Date(today);
            nextReviewDate.setDate(today.getDate() + DIFFICULTY_INTERVALS[difficulty]);
            
            // æ›´æ–°è¨˜æ†¶æ•¸æ“š
            if (!memoryData[question.id]) {
                memoryData[question.id] = {reviews: 0};
            }
            
            memoryData[question.id] = {
                ...memoryData[question.id],
                difficulty: difficulty,
                lastReview: today.toDateString(),
                nextReview: nextReviewDate.toDateString(),
                reviews: (memoryData[question.id].reviews || 0) + 1
            };
            
            saveMemoryData();
            
            const feedbackMessages = {
                'hard': 'æ¨™è¨˜ç‚ºå›°é›£ï¼Œæ˜å¤©å°‡å†æ¬¡å¾©ç¿’',
                'medium': 'æ¨™è¨˜ç‚ºä¸€èˆ¬ï¼Œ3å¤©å¾Œå¾©ç¿’', 
                'easy': 'æ¨™è¨˜ç‚ºç°¡å–®ï¼Œä¸€é€±å¾Œå¾©ç¿’',
                'mastered': 'å¤ªæ£’äº†ï¼å·²æŒæ¡ï¼Œä¸€å€‹æœˆå¾Œå¾©ç¿’'
            };
            
            showNotification(feedbackMessages[difficulty], 'success');
            
            // è‡ªå‹•ç§»å‹•åˆ°ä¸‹ä¸€å¼µå¡ç‰‡
            setTimeout(() => {
                nextMemoryCard();
            }, 1000);
        }

        function nextMemoryCard() {
            if (currentMemoryIndex < memoryQuestions.length - 1) {
                currentMemoryIndex++;
                showMemoryCard(currentMemoryIndex);
            } else {
                // å®Œæˆé€™è¼ªç·´ç¿’
                showNotification('ğŸ‰ æœ¬è¼ªè¨˜æ†¶ç·´ç¿’å®Œæˆï¼', 'success');
                prepareMemoryQuestions();
                if (memoryQuestions.length > 0) {
                    currentMemoryIndex = 0;
                    showMemoryCard(0);
                } else {
                    exitMemoryPractice();
                }
            }
            updateMemoryStats();
        }

        function previousMemoryCard() {
            if (currentMemoryIndex > 0) {
                currentMemoryIndex--;
                showMemoryCard(currentMemoryIndex);
            }
        }

        function updateMemoryButtonStates() {
            const prevBtn = document.getElementById('memory-prev-btn');
            const nextBtn = document.getElementById('memory-next-btn');
            
            if (prevBtn) prevBtn.disabled = currentMemoryIndex === 0;
            if (nextBtn) nextBtn.disabled = currentMemoryIndex === memoryQuestions.length - 1;
        }

        function exitMemoryPractice() {
            isMemoryPracticing = false;
            isCardFlipped = false;
            document.getElementById('flashcard-container-inner').classList.remove('flipped');
            document.getElementById('back-to-question-btn').style.display = 'none';
            showNotification('å·²é€€å‡ºè¨˜æ†¶ç·´ç¿’', 'info');
        }

        function updateMemoryStats() {
            const total = questions.length;
            let mastered = 0, learning = 0, difficult = 0;
            
            questions.forEach(q => {
                const memoryInfo = memoryData[q.id];
                if (memoryInfo) {
                    switch(memoryInfo.difficulty) {
                        case 'mastered': mastered++; break;
                        case 'hard': difficult++; break;
                        case 'medium':
                        case 'easy': learning++; break;
                    }
                }
            });
            
            document.getElementById('memory-total').textContent = total - mastered - learning - difficult;
            document.getElementById('memory-mastered').textContent = mastered;
            document.getElementById('memory-learning').textContent = learning;
            document.getElementById('memory-difficult').textContent = difficult;
        }

        function resetMemoryData() {
            if (confirm('ç¢ºå®šè¦é‡ç½®æ‰€æœ‰è¨˜æ†¶æ•¸æ“šå—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸï¼')) {
                memoryData = {};
                saveMemoryData();
                updateMemoryStats();
                updateStats();
                showNotification('è¨˜æ†¶æ•¸æ“šå·²é‡ç½®ï¼', 'success');
            }
        }

        // ===== è¼”åŠ©å‡½æ•¸ =====
        function highlightKeywords(text) {
            let highlightedText = text;
            ERP_KEYWORDS.forEach(keyword => {
                const regex = new RegExp(`(${keyword})`, 'gi');
                highlightedText = highlightedText.replace(regex, '<span class="keyword-highlight">$1</span>');
            });
            return highlightedText;
        }

        function generateMemoryTip(question) {
            const tips = [
                `ğŸ’¡ è¨˜æ†¶æç¤ºï¼šæ³¨æ„é¡Œç›®ä¸­çš„é—œéµè©ã€Œ${extractKeywords(question.question)[0] || 'ERP'}ã€`,
                `ğŸ”— è¯æƒ³è¨˜æ†¶ï¼šé€™å€‹æ¦‚å¿µèˆ‡ã€Œ${question.chapter.split(' ')[1]}ã€å¯†åˆ‡ç›¸é—œ`,
                `ğŸ“ å£è¨£æç¤ºï¼šé¸é …${question.answer} - è¨˜ä½ç¬¬ä¸€å€‹å­—ã€Œ${getFirstChar(question)}ã€`,
                `ğŸ¯ é‡é»ï¼šæ­¤é¡Œè€ƒæŸ¥çš„æ ¸å¿ƒæ¦‚å¿µæ˜¯ã€Œ${extractConcept(question.question)}ã€`
            ];
            return `<div class="memory-tip">${tips[Math.floor(Math.random() * tips.length)]}</div>`;
        }

        function extractKeywords(text) {
            return ERP_KEYWORDS.filter(keyword => 
                text.toLowerCase().includes(keyword.toLowerCase()));
        }

        function getFirstChar(question) {
            const correctOption = question.options.find(opt => {
                const match = opt.match(/^\(([A-D])\)/);
                return match && match[1] === question.answer;
            });
            if (correctOption) {
                const text = correctOption.replace(/^\([A-D]\)\s*/, '');
                return text.charAt(0);
            }
            return '';
        }

        function extractConcept(text) {
            const concepts = ['ç³»çµ±', 'æ¨¡çµ„', 'æµç¨‹', 'ç®¡ç†', 'è¦åŠƒ', 'æ§åˆ¶', 'åˆ†æ'];
            for (let concept of concepts) {
                if (text.includes(concept)) return concept;
            }
            return 'ERPæ¦‚å¿µ';
        }

        // ===== é€šçŸ¥ç³»çµ± =====
        function createNotificationContainer() {
            notificationContainer = document.createElement('div');
            notificationContainer.id = 'notification-container';
            notificationContainer.style.cssText = `
                position: fixed;
                top: 100px;
                right: 20px;
                z-index: 1001;
                pointer-events: none;
            `;
            document.body.appendChild(notificationContainer);
        }

        function showNotification(message, type = 'info', duration = 3000) {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            notification.style.pointerEvents = 'auto';
            
            if (!notificationContainer) {
                createNotificationContainer();
            }
            
            notificationContainer.appendChild(notification);
            
            // é¡¯ç¤ºå‹•ç•«
            setTimeout(() => {
                notification.classList.add('show');
            }, 10);
            
            // è‡ªå‹•éš±è—
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, duration);
            
            // é»æ“Šé—œé–‰
            notification.onclick = () => {
                notification.classList.remove('show');
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            };
        }

        function showMemoryStatus(message = 'è¨˜éŒ„å·²è‡ªå‹•ä¿å­˜') {
            const indicator = document.getElementById('memory-status');
            if (indicator) {
                indicator.textContent = `ğŸ’¾ ${message}`;
                indicator.style.opacity = '1';
                indicator.style.transform = 'translateY(0)';
                
                const memoryCount = Object.keys(memoryData).length;
                const masteredCount = Object.values(memoryData).filter(d => d.difficulty === 'mastered').length;
                
                indicator.title = `è¨˜æ†¶æ•¸æ“šï¼š${memoryCount}é¡Œï¼Œå·²æŒæ¡ï¼š${masteredCount}é¡Œ\né»æ“ŠæŸ¥çœ‹è©³ç´°çµ±è¨ˆ`;
                
                setTimeout(() => {
                    indicator.style.opacity = '0.6';
                    indicator.style.transform = 'translateY(10px)';
                }, 2000);
            }
        }

        // ===== å…¶ä»–æ ¸å¿ƒå‡½æ•¸ =====
        function selectOption(letter, element) {
            if (showingAnswer) return;
            
            document.querySelectorAll('.option').forEach(opt => {
                opt.classList.remove('selected');
            });
            
            element.classList.add('selected');
            
            document.getElementById('submit-btn').style.display = 'inline-block';
            document.getElementById('next-btn').style.display = 'none';
        }

        function submitAnswer() {
            const question = questions[currentQuestionIndex];
            const selectedOption = document.querySelector('.option.selected');
            
            if (!selectedOption) return;
            
            const userAnswer = selectedOption.querySelector('.option-letter').textContent;
            userAnswers[question.id] = userAnswer;
            
            showingAnswer = true;
            const options = document.querySelectorAll('.option');
            
            options.forEach(opt => {
                const letter = opt.querySelector('.option-letter').textContent;
                if (letter === question.answer) {
                    opt.classList.add('correct');
                } else if (letter === userAnswer && letter !== question.answer) {
                    opt.classList.add('incorrect');
                }
            });
            
            document.getElementById('submit-btn').style.display = 'none';
            document.getElementById('next-btn').style.display = 'inline-block';
            
            saveAnswers();
            updateStats();
            generateOverview();
            updateResults();
            
            if (userAnswer === question.answer) {
                showNotification('å›ç­”æ­£ç¢ºï¼âœ…', 'success');
            } else {
                showNotification(`å›ç­”éŒ¯èª¤ï¼æ­£ç¢ºç­”æ¡ˆæ˜¯ ${question.answer}`, 'error');
            }
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                showQuestion(currentQuestionIndex - 1);
            }
        }

        function nextQuestion() {
            if (currentQuestionIndex < questions.length - 1) {
                showQuestion(currentQuestionIndex + 1);
            }
        }

        function goToQuestion() {
            const questionId = parseInt(document.getElementById('question-input').value);
            const index = questions.findIndex(q => q.id === questionId);
            
            if (index !== -1) {
                showQuestion(index);
            } else {
                showNotification('é¡Œç›®ç·¨è™Ÿä¸å­˜åœ¨ï¼', 'error');
            }
        }

        function goToRandomQuestion() {
            const randomIndex = Math.floor(Math.random() * questions.length);
            showQuestion(randomIndex);
            showNotification(`éš¨æ©Ÿè·³åˆ°é¡Œç›® ${questions[randomIndex].id}`, 'info');
        }

        function markForReview() {
            const question = questions[currentQuestionIndex];
            const markedQuestions = loadFromStorage(STORAGE_KEYS.MARKED_FOR_REVIEW, []);
            
            if (markedQuestions.includes(question.id)) {
                // å–æ¶ˆæ¨™è¨˜
                const index = markedQuestions.indexOf(question.id);
                markedQuestions.splice(index, 1);
                showNotification('å·²å–æ¶ˆå¾©ç¿’æ¨™è¨˜', 'info');
            } else {
                // æ·»åŠ æ¨™è¨˜
                markedQuestions.push(question.id);
                showNotification('å·²æ¨™è¨˜ç‚ºéœ€è¦å¾©ç¿’ï¼â­', 'success');
            }
            
            saveToStorage(STORAGE_KEYS.MARKED_FOR_REVIEW, markedQuestions);
        }

        function updateButtonStates() {
            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');
            
            prevBtn.disabled = currentQuestionIndex === 0;
            nextBtn.disabled = currentQuestionIndex === questions.length - 1;
        }

        function updateOverviewHighlight() {
            document.querySelectorAll('.question-number').forEach(el => {
                el.classList.remove('current');
            });
            
            const currentEl = document.querySelector(`[onclick*="${questions[currentQuestionIndex].id}"]`);
            if (currentEl) {
                currentEl.classList.add('current');
            }
        }

        // ===== éŒ¯é¡Œç·´ç¿’å‡½æ•¸ =====
        function getWrongQuestions() {
            return questions.filter(q => {
                const userAnswer = userAnswers[q.id];
                return userAnswer && userAnswer !== q.answer;
            });
        }

        function updateWrongQuestionsDisplay() {
            wrongQuestions = getWrongQuestions();
            const countText = document.getElementById('wrong-count-text');
            const badge = document.getElementById('wrong-progress-badge');
            
            if (wrongQuestions.length === 0) {
                countText.textContent = 'è«‹å…ˆå®Œæˆä¸€äº›é¡Œç›®ä¾†å»ºç«‹éŒ¯é¡Œåº«';
                badge.textContent = 'æš«ç„¡éŒ¯é¡Œ';
            } else {
                countText.textContent = `ç™¼ç¾ ${wrongQuestions.length} é“éŒ¯é¡Œï¼Œå»ºè­°é‡æ–°ç·´ç¿’`;
                badge.textContent = `${wrongQuestions.length} é“éŒ¯é¡Œ`;
            }
        }

        function startWrongPractice() {
            wrongQuestions = getWrongQuestions();
            
            if (wrongQuestions.length === 0) {
                showNotification('æš«ç„¡éŒ¯é¡Œï¼Œè«‹å…ˆå®Œæˆä¸€äº›é¡Œç›®ï¼', 'error');
                return;
            }
            
            document.getElementById('wrong-welcome').style.display = 'none';
            document.getElementById('wrong-practice-content').style.display = 'block';
            
            currentWrongIndex = loadFromStorage(STORAGE_KEYS.LAST_WRONG_QUESTION, 0);
            if (currentWrongIndex >= wrongQuestions.length) {
                currentWrongIndex = 0;
            }
            
            showWrongQuestion(currentWrongIndex);
            updateWrongProgress();
            showNotification(`é–‹å§‹éŒ¯é¡Œç·´ç¿’ï¼Œå…± ${wrongQuestions.length} é“é¡Œç›®`, 'success');
        }

        function showWrongQuestion(index) {
            if (index < 0 || index >= wrongQuestions.length) return;
            
            currentWrongIndex = index;
            const question = wrongQuestions[index];
            showingWrongAnswer = false;
            
            document.getElementById('wrong-current-badge').textContent = `éŒ¯é¡Œ ${index + 1}`;
            document.getElementById('wrong-chapter-badge').textContent = question.chapter;
            document.getElementById('wrong-question-text').textContent = question.question;
            
            const optionsContainer = document.getElementById('wrong-options-container');
            optionsContainer.innerHTML = '';
            
            if (question.options && question.options.length > 0) {
                question.options.forEach((option, i) => {
                    const optionEl = document.createElement('div');
                    optionEl.className = 'option';
                    
                    const letterMatch = option.match(/^\(([A-D])\)/);
                    if (letterMatch) {
                        const letter = letterMatch[1];
                        const text = option.replace(/^\([A-D]\)\s*/, '');
                        
                        optionEl.innerHTML = `
                            <div class="option-letter">${letter}</div>
                            <div>${text}</div>
                        `;
                        
                        optionEl.onclick = () => selectWrongOption(letter, optionEl);
                        
                        const userAnswer = userAnswers[question.id];
                        if (letter === userAnswer) {
                            optionEl.classList.add('incorrect');
                            optionEl.innerHTML += '<small style="color: var(--error-red); display: block; margin-top: 0.5rem;">ä¸Šæ¬¡é¸æ“‡ï¼ˆéŒ¯èª¤ï¼‰</small>';
                        }
                        if (letter === question.answer) {
                            optionEl.classList.add('correct');
                            optionEl.innerHTML += '<small style="color: var(--success-green); display: block; margin-top: 0.5rem;">æ­£ç¢ºç­”æ¡ˆ</small>';
                        }
                    }
                    
                    optionsContainer.appendChild(optionEl);
                });
            }
            
            if (wrongAnswers[question.id]) {
                const selectedOption = optionsContainer.querySelector(`[onclick*="${wrongAnswers[question.id]}"]`);
                if (selectedOption) {
                    selectedOption.classList.add('selected');
                }
            }
            
            updateWrongButtonStates();
            updateWrongProgress();
            saveWrongAnswers();
        }

        function selectWrongOption(letter, element) {
            if (showingWrongAnswer) return;
            
            document.querySelectorAll('#wrong-options-container .option').forEach(opt => {
                opt.classList.remove('selected');
            });
            
            element.classList.add('selected');
            
            document.getElementById('wrong-submit-btn').style.display = 'inline-block';
            document.getElementById('wrong-next-btn').style.display = 'none';
        }

        function submitWrongAnswer() {
            const question = wrongQuestions[currentWrongIndex];
            const selectedOption = document.querySelector('#wrong-options-container .option.selected');
            
            if (!selectedOption) return;
            
            const userAnswer = selectedOption.querySelector('.option-letter').textContent;
            wrongAnswers[question.id] = userAnswer;
            
            document.getElementById('wrong-submit-btn').style.display = 'none';
            document.getElementById('wrong-next-btn').style.display = 'inline-block';
            
            saveWrongAnswers();
            
            if (userAnswer === question.answer) {
                showNotification('é€™æ¬¡ç­”å°äº†ï¼âœ…', 'success');
            } else {
                showNotification(`é‚„æ˜¯éŒ¯èª¤ï¼æ­£ç¢ºç­”æ¡ˆæ˜¯ ${question.answer}`, 'error');
            }
        }

        function previousWrongQuestion() {
            if (currentWrongIndex > 0) {
                showWrongQuestion(currentWrongIndex - 1);
            }
        }

        function nextWrongQuestion() {
            if (currentWrongIndex < wrongQuestions.length - 1) {
                showWrongQuestion(currentWrongIndex + 1);
            }
        }

        function updateWrongButtonStates() {
            const prevBtn = document.getElementById('wrong-prev-btn');
            const nextBtn = document.getElementById('wrong-next-btn');
            
            if (prevBtn) prevBtn.disabled = currentWrongIndex === 0;
            if (nextBtn) nextBtn.disabled = currentWrongIndex === wrongQuestions.length - 1;
        }

        function updateWrongProgress() {
            const progressText = document.getElementById('wrong-progress-text');
            if (wrongQuestions.length > 0) {
                progressText.textContent = `${currentWrongIndex + 1} / ${wrongQuestions.length}`;
            } else {
                progressText.textContent = '0 / 0';
            }
        }

        function resetWrongQuestions() {
            if (confirm('ç¢ºå®šè¦é‡ç½®éŒ¯é¡Œè¨˜éŒ„å—ï¼Ÿé€™å°‡æ¸…é™¤éŒ¯é¡Œç·´ç¿’çš„é€²åº¦ã€‚')) {
                wrongAnswers = {};
                currentWrongIndex = 0;
                saveWrongAnswers();
                
                document.getElementById('wrong-welcome').style.display = 'block';
                document.getElementById('wrong-practice-content').style.display = 'none';
                
                updateWrongQuestionsDisplay();
                showNotification('éŒ¯é¡Œè¨˜éŒ„å·²é‡ç½®ï¼', 'success');
            }
        }

        function exitWrongPractice() {
            document.getElementById('wrong-welcome').style.display = 'block';
            document.getElementById('wrong-practice-content').style.display = 'none';
            showNotification('å·²é€€å‡ºéŒ¯é¡Œç·´ç¿’', 'info');
        }

        // ===== çµæœçµ±è¨ˆå‡½æ•¸ =====
        function updateResults() {
            const answered = Object.keys(userAnswers).length;
            const correct = Object.entries(userAnswers).filter(([id, answer]) => {
                const question = questions.find(q => q.id == id);
                return question && question.answer === answer;
            }).length;
            const incorrect = answered - correct;
            const accuracy = answered > 0 ? Math.round((correct / answered) * 100) : 0;
            
            document.getElementById('result-correct').textContent = correct;
            document.getElementById('result-incorrect').textContent = incorrect;
            document.getElementById('result-total').textContent = answered;
            document.getElementById('accuracy-rate').textContent = `${accuracy}%`;
            
            // ç”Ÿæˆå­¸ç¿’åˆ†æ
            generateStudyAnalysis(answered, correct, incorrect, accuracy);
            
            // æ›´æ–°éŒ¯é¡Œåˆ—è¡¨
            updateIncorrectQuestionsList();
        }

        function generateStudyAnalysis(answered, correct, incorrect, accuracy) {
            const analysisContainer = document.getElementById('study-analysis');
            if (!analysisContainer) return;
            
            const chapterStats = {};
            const totalByChapter = {};
            
            // æŒ‰ç« ç¯€çµ±è¨ˆ
            questions.forEach(q => {
                const chapter = q.chapter;
                if (!totalByChapter[chapter]) {
                    totalByChapter[chapter] = 0;
                    chapterStats[chapter] = { correct: 0, total: 0 };
                }
                totalByChapter[chapter]++;
                
                if (userAnswers[q.id]) {
                    chapterStats[chapter].total++;
                    if (userAnswers[q.id] === q.answer) {
                        chapterStats[chapter].correct++;
                    }
                }
            });
            
            const analysisHtml = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
                    <div class="result-card">
                        <div class="result-number" style="color: ${accuracy >= 80 ? 'var(--success-green)' : accuracy >= 60 ? 'var(--warning-orange)' : 'var(--error-red)'};">${accuracy}%</div>
                        <h4>å­¸ç¿’æŒæ¡åº¦</h4>
                        <small>${accuracy >= 80 ? 'å„ªç§€' : accuracy >= 60 ? 'è‰¯å¥½' : 'éœ€è¦åŠ å¼·'}</small>
                    </div>
                    <div class="result-card">
                        <div class="result-number" style="color: var(--primary-blue);">${Object.keys(chapterStats).length}</div>
                        <h4>æ¶‰åŠç« ç¯€</h4>
                        <small>å…±${Object.keys(totalByChapter).length}ç« </small>
                    </div>
                    <div class="result-card">
                        <div class="result-number" style="color: var(--warning-orange);">${Math.round((answered / questions.length) * 100)}%</div>
                        <h4>å®Œæˆé€²åº¦</h4>
                        <small>${answered}/${questions.length}é¡Œ</small>
                    </div>
                </div>
                
                <div style="background: var(--gray-50); padding: 1.5rem; border-radius: 8px; margin-bottom: 1rem;">
                    <h5 style="margin-bottom: 1rem;">ğŸ“Š å„ç« ç¯€è¡¨ç¾åˆ†æ</h5>
                    ${Object.entries(chapterStats).map(([chapter, stats]) => {
                        const chapterAccuracy = stats.total > 0 ? Math.round((stats.correct / stats.total) * 100) : 0;
                        const progressWidth = stats.total > 0 ? (stats.total / totalByChapter[chapter]) * 100 : 0;
                        
                        return `
                            <div style="margin-bottom: 1rem; padding: 1rem; background: white; border-radius: 6px;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                                    <strong style="font-size: 0.9rem;">${chapter}</strong>
                                    <span style="color: ${chapterAccuracy >= 80 ? 'var(--success-green)' : chapterAccuracy >= 60 ? 'var(--warning-orange)' : 'var(--error-red)'}; font-weight: bold;">
                                        ${chapterAccuracy}% (${stats.correct}/${stats.total})
                                    </span>
                                </div>
                                <div style="background: var(--gray-200); height: 8px; border-radius: 4px; overflow: hidden;">
                                    <div style="background: ${chapterAccuracy >= 80 ? 'var(--success-green)' : chapterAccuracy >= 60 ? 'var(--warning-orange)' : 'var(--error-red)'}; height: 100%; width: ${progressWidth}%; transition: width 0.3s ease;"></div>
                                </div>
                                <small style="color: var(--gray-600);">å·²å®Œæˆ ${stats.total}/${totalByChapter[chapter]} é¡Œ</small>
                            </div>
                        `;
                    }).join('')}
                </div>
                
                ${answered > 0 ? `
                    <div style="background: var(--light-blue); padding: 1.5rem; border-radius: 8px;">
                        <h5 style="color: var(--primary-blue); margin-bottom: 1rem;">ğŸ’¡ å­¸ç¿’å»ºè­°</h5>
                        <ul style="line-height: 1.6; margin-left: 1rem; color: var(--gray-700);">
                            ${accuracy < 60 ? '<li>å»ºè­°é‡é»å¾©ç¿’åŸºç¤æ¦‚å¿µï¼Œå¤šåšç·´ç¿’é¡Œ</li>' : ''}
                            ${incorrect > 0 ? '<li>é‡é»é—œæ³¨éŒ¯é¡Œç·´ç¿’ï¼Œéå›ºè–„å¼±çŸ¥è­˜é»</li>' : ''}
                            ${answered < questions.length * 0.5 ? '<li>å»ºè­°å¢åŠ ç·´ç¿’é‡ï¼Œå®Œæˆæ›´å¤šé¡Œç›®</li>' : ''}
                            ${accuracy >= 80 ? '<li>è¡¨ç¾å„ªç§€ï¼å¯ä»¥å˜—è©¦è¨˜æ†¶æ¨¡å¼ä¾†é•·æœŸéå›ºçŸ¥è­˜</li>' : ''}
                            <li>å®šæœŸå¾©ç¿’å·²æŒæ¡çš„é¡Œç›®ï¼Œé¿å…éºå¿˜</li>
                        </ul>
                    </div>
                ` : ''}
            `;
            
            analysisContainer.innerHTML = analysisHtml;
        }

        function updateIncorrectQuestionsList() {
            const incorrectContainer = document.getElementById('incorrect-questions');
            const incorrectQuestions = Object.entries(userAnswers).filter(([id, answer]) => {
                const question = questions.find(q => q.id == id);
                return question && question.answer !== answer;
            });
            
            if (incorrectQuestions.length === 0) {
                incorrectContainer.innerHTML = '<p style="text-align: center; color: var(--gray-600); padding: 2rem;">é‚„æ²’æœ‰éŒ¯é¡Œè¨˜éŒ„ï¼Œç¹¼çºŒåŠ æ²¹ï¼ ğŸ’ª</p>';
                return;
            }
            
            incorrectContainer.innerHTML = incorrectQuestions.map(([id, userAnswer]) => {
                const question = questions.find(q => q.id == id);
                if (!question) return '';
                
                const optionsHtml = question.options.map(option => {
                    const letterMatch = option.match(/^\(([A-D])\)/);
                    if (!letterMatch) return `<div style="padding: 0.25rem 0;">${option}</div>`;
                    
                    const letter = letterMatch[1];
                    const text = option.replace(/^\([A-D]\)\s*/, '');
                    
                    let className = 'padding: 0.5rem; margin: 0.25rem 0; border-radius: 4px;';
                    let suffix = '';
                    
                    if (letter === question.answer) {
                        className += ' background: var(--light-green); border-left: 3px solid var(--success-green); color: var(--success-green);';
                        suffix = ' âœ“ æ­£ç¢ºç­”æ¡ˆ';
                    } else if (letter === userAnswer) {
                        className += ' background: var(--light-red); border-left: 3px solid var(--error-red); color: var(--error-red);';
                        suffix = ' âœ— ä½ çš„ç­”æ¡ˆ';
                    } else {
                        className += ' background: var(--gray-50);';
                    }
                    
                    return `<div style="${className}"><strong>${letter})</strong> ${text}${suffix}</div>`;
                }).join('');
                
                return `
                    <div style="border: 1px solid var(--gray-200); border-radius: 8px; padding: 1.5rem; margin-bottom: 1rem; background: white;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; gap: 1rem; flex-wrap: wrap;">
                            <div style="display: flex; gap: 1rem; align-items: center;">
                                <span style="background: var(--error-red); color: white; padding: 0.5rem 1rem; border-radius: 20px; font-weight: bold; font-size: 0.9rem;">
                                    é¡Œç›® ${id}
                                </span>
                                <span style="background: var(--light-blue); color: var(--primary-blue); padding: 0.25rem 0.75rem; border-radius: 15px; font-size: 0.8rem;">
                                    ${question.chapter}
                                </span>
                            </div>
                            <button class="btn btn-secondary" onclick="practiceThisQuestion(${id})" style="font-size: 0.8rem; padding: 0.4rem 0.8rem;">
                                é‡æ–°ç·´ç¿’
                            </button>
                        </div>
                        
                        <div style="font-size: 1.1rem; line-height: 1.6; margin-bottom: 1rem; color: var(--gray-800);">
                            <strong>é¡Œç›®ï¼š</strong>${question.question}
                        </div>
                        
                        <div style="margin-bottom: 1rem;">
                            <strong>é¸é …ï¼š</strong>
                            <div style="margin-top: 0.5rem;">
                                ${optionsHtml}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function practiceThisQuestion(questionId) {
            const questionIndex = questions.findIndex(q => q.id == questionId);
            if (questionIndex !== -1) {
                currentQuestionIndex = questionIndex;
                showPanel('practice');
                showQuestion(currentQuestionIndex);
                showNotification(`è·³è½‰åˆ°é¡Œç›® ${questionId}`, 'success');
            }
        }

        function exportStudyData() {
            const studyData = {
                timestamp: new Date().toISOString(),
                totalQuestions: questions.length,
                userAnswers: userAnswers,
                memoryData: memoryData,
                statistics: {
                    answered: Object.keys(userAnswers).length,
                    correct: Object.entries(userAnswers).filter(([id, answer]) => {
                        const question = questions.find(q => q.id == id);
                        return question && question.answer === answer;
                    }).length,
                    mastered: Object.values(memoryData).filter(d => d.difficulty === 'mastered').length
                }
            };
            
            const dataStr = JSON.stringify(studyData, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `ERPå­¸ç¿’æ•¸æ“š_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('å­¸ç¿’æ•¸æ“šå·²å°å‡ºï¼', 'success');
        }

        function clearAllData() {
            if (confirm('ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰ç­”é¡Œè¨˜éŒ„å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸï¼')) {
                Object.values(STORAGE_KEYS).forEach(key => {
                    localStorage.removeItem(key);
                });
                
                userAnswers = {};
                wrongAnswers = {};
                memoryData = {};
                currentQuestionIndex = 0;
                currentWrongIndex = 0;
                
                updateStats();
                updateResults();
                generateOverview();
                updateWrongQuestionsDisplay();
                updateMemoryStats();
                
                showNotification('æ‰€æœ‰è¨˜éŒ„å·²æ¸…é™¤ï¼', 'success');
            }
        }

        // ===== ç€è¦½æ¨¡å¼å‡½æ•¸ =====
        function generateBrowseContent(filteredQuestions = null) {
            const container = document.getElementById('browse-container');
            const questionsToShow = filteredQuestions || questions;
            
            if (questionsToShow.length === 0) {
                container.innerHTML = '<p style="text-align: center; padding: 2rem; color: var(--gray-600);">æ²’æœ‰æ‰¾åˆ°ç¬¦åˆæ¢ä»¶çš„é¡Œç›®</p>';
                return;
            }
            
            container.innerHTML = questionsToShow.map(q => {
                let optionsHtml = '';
                
                if (q.options && q.options.length > 0) {
                    optionsHtml = q.options.map(option => {
                        const letterMatch = option.match(/^\(([A-D])\)/);
                        if (letterMatch) {
                            const optionLetter = letterMatch[1];
                            const optionText = option.replace(/^\([A-D]\)\s*/, '');
                            const isCorrect = optionLetter === q.answer;
                            
                            return `
                                <div class="browse-option ${isCorrect ? 'correct-answer' : ''}">
                                    <strong>${optionLetter})</strong> ${optionText}
                                    ${isCorrect ? ' âœ“' : ''}
                                </div>
                            `;
                        } else {
                            return `
                                <div class="browse-option">
                                    <strong>?)</strong> ${option}
                                </div>
                            `;
                        }
                    }).join('');
                } else {
                    optionsHtml = `
                        <div style="color: var(--error-red); font-style: italic; padding: 1rem;">
                            âš ï¸ æ­¤é¡Œç›®é¸é …è§£æå¤±æ•—ï¼Œå¯èƒ½åŸå§‹æ ¼å¼æœ‰å•é¡Œ
                        </div>
                    `;
                }
                
                return `
                    <div class="browse-item">
                        <div class="browse-question-header">
                            <div style="display: flex; gap: 1rem; align-items: center; flex-wrap: wrap;">
                                <div class="browse-question-number">é¡Œç›® ${q.id}</div>
                                <div class="browse-chapter">${q.chapter}</div>
                            </div>
                            <div class="browse-answer">ç­”æ¡ˆ: ${q.answer}</div>
                        </div>
                        
                        <div class="browse-question-text">${q.question}</div>
                        
                        <div class="browse-options">
                            ${optionsHtml}
                        </div>
                        
                        ${q.options.length === 0 ? 
                            `<div style="margin-top: 1rem; padding: 1rem; background: var(--light-red); border-radius: 6px; font-size: 0.9rem;">
                                <strong>èª¿è©¦ä¿¡æ¯ï¼š</strong>æ­¤é¡Œç›®åœ¨CSVè§£ææ™‚æœªæ‰¾åˆ°æœ‰æ•ˆé¸é …ï¼Œè«‹æª¢æŸ¥åŸå§‹æª”æ¡ˆä¸­é¡Œç›® ${q.id} çš„æ ¼å¼ã€‚
                            </div>` : ''
                        }
                    </div>
                `;
            }).join('');
        }

        function generateChapterFilter() {
            const select = document.getElementById('chapter-filter');
            const chapters = [...new Set(questions.map(q => q.chapter))].sort();
            
            select.innerHTML = '<option value="">æ‰€æœ‰ç« ç¯€</option>' + 
                chapters.map(chapter => `<option value="${chapter}">${chapter}</option>`).join('');
        }

        function filterByChapter() {
            const selectedChapter = document.getElementById('chapter-filter').value;
            const filterBadge = document.getElementById('browse-filter');
            
            if (selectedChapter) {
                const filteredQuestions = questions.filter(q => q.chapter === selectedChapter);
                generateBrowseContent(filteredQuestions);
                filterBadge.textContent = selectedChapter;
            } else {
                generateBrowseContent();
                filterBadge.textContent = 'æ‰€æœ‰ç« ç¯€';
            }
        }

        // ===== æ–‡ä»¶ä¸Šå‚³å‡½æ•¸ =====
        function uploadCSVFile() {
            const fileInput = document.getElementById('csv-file-upload');
            const file = fileInput.files[0];
            
            if (!file) {
                showNotification('è«‹å…ˆé¸æ“‡CSVæ–‡ä»¶ï¼', 'error');
                return;
            }
            
            if (!file.name.toLowerCase().endsWith('.csv')) {
                showNotification('è«‹é¸æ“‡CSVæ ¼å¼çš„æ–‡ä»¶ï¼', 'error');
                return;
            }
            
            showNotification('æ­£åœ¨è®€å–æ–‡ä»¶...', 'info');
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const csvContent = e.target.result;
                
                // æ¸…ç©ºç¾æœ‰é¡Œç›®
                questions = [];
                userAnswers = {};
                
                // è§£ææ–°çš„CSVå…§å®¹
                parseCSVContent(csvContent);
                
                if (questions.length > 0) {
                    // é‡æ–°åˆå§‹åŒ–ç•Œé¢
                    generateOverview();
                    generateBrowseContent();
                    generateChapterFilter();
                    updateStats();
                    showQuestion(0);
                    updateResults();
                    
                    // éš±è—ä¸Šå‚³å€åŸŸ
                    document.getElementById('upload-section').style.display = 'none';
                    
                    showNotification(`æˆåŠŸè¼‰å…¥ ${questions.length} é“é¡Œç›®ï¼ğŸ‰`, 'success');
                } else {
                    showNotification('CSVæ–‡ä»¶æ ¼å¼ä¸æ­£ç¢ºï¼Œè«‹æª¢æŸ¥æ–‡ä»¶å…§å®¹ï¼', 'error');
                }
            };
            
            reader.onerror = function() {
                showNotification('æ–‡ä»¶è®€å–å¤±æ•—ï¼Œè«‹é‡è©¦ï¼', 'error');
            };
            
            reader.readAsText(file, 'UTF-8');
        }

        // ===== é¢æ¿åˆ‡æ›å‡½æ•¸ =====
        function showPanel(panelName) {
            // éš±è—æ‰€æœ‰é¢æ¿
            document.querySelectorAll('.panel').forEach(panel => {
                panel.classList.remove('active');
            });
            
            // ç§»é™¤æ‰€æœ‰æ¨™ç±¤çš„æ¿€æ´»ç‹€æ…‹
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // é¡¯ç¤ºæŒ‡å®šé¢æ¿
            document.getElementById(`${panelName}-panel`).classList.add('active');
            
            // æ¿€æ´»å°æ‡‰æ¨™ç±¤
            if (event && event.target) {
                event.target.classList.add('active');
            } else {
                // å¦‚æœæ²’æœ‰eventï¼Œæ‰‹å‹•æ‰¾åˆ°å°æ‡‰çš„tab
                const tabs = document.querySelectorAll('.nav-tab');
                const panelNames = ['overview', 'practice', 'browse', 'memory', 'wrong', 'results', 'debug'];
                const index = panelNames.indexOf(panelName);
                if (index !== -1 && tabs[index]) {
                    tabs[index].classList.add('active');
                }
            }
            
            // ç‰¹æ®Šè™•ç†
            if (panelName === 'browse' && document.getElementById('browse-container').innerHTML === '') {
                generateBrowseContent();
                generateChapterFilter();
            } else if (panelName === 'wrong') {
                updateWrongQuestionsDisplay();
            } else if (panelName === 'results') {
                updateResults();
            } else if (panelName === 'memory') {
                updateMemoryStats();
            }
        }

        // ===== å“è³ªæª¢æŸ¥å‡½æ•¸ =====
        function checkQuestionQuality() {
            const problemQuestions = questions.filter(q => !q.options || q.options.length < 2);
            const incompleteQuestions = questions.filter(q => q.options && q.options.length < 4);
            const goodQuestions = questions.filter(q => q.options && q.options.length >= 4);
            
            console.log(`é¡Œåº«å“è³ªæª¢æŸ¥:`);
            console.log(`- ç¸½é¡Œç›®æ•¸: ${questions.length}`);
            console.log(`- å•é¡Œé¡Œç›®æ•¸ (é¸é …<2): ${problemQuestions.length}`);
            console.log(`- ä¸å®Œæ•´é¡Œç›®æ•¸ (é¸é …<4): ${incompleteQuestions.length}`);
            console.log(`- å®Œæ•´é¡Œç›®æ•¸ (é¸é …>=4): ${goodQuestions.length}`);
            
            if (problemQuestions.length > 0) {
                console.log('å•é¡Œé¡Œç›®ç·¨è™Ÿ:', problemQuestions.map(q => q.id));
            }
            
            generateDebugContent(problemQuestions, incompleteQuestions, goodQuestions);
            
            // å¦‚æœæœ‰å•é¡Œé¡Œç›®ï¼Œé¡¯ç¤ºèª¿è©¦æ¨™ç±¤
            if (problemQuestions.length > 0 || incompleteQuestions.length > 10) {
                document.getElementById('debug-tab').style.display = 'block';
            }
            
            // å¦‚æœå•é¡Œé¡Œç›®å¾ˆå¤šï¼Œé¡¯ç¤ºè­¦å‘Š
            if (problemQuestions.length > questions.length * 0.1) {
                setTimeout(() => {
                    showNotification(`âš ï¸ ç™¼ç¾ ${problemQuestions.length} é“é¡Œç›®é¸é …è§£ææœ‰å•é¡Œ`, 'warning');
                }, 3000);
            }
        }

        function generateDebugContent(problemQuestions, incompleteQuestions, goodQuestions) {
            const debugContainer = document.getElementById('debug-content');
            
            const debugHtml = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
                    <div class="result-card">
                        <div class="result-number" style="color: var(--success-green);">${goodQuestions.length}</div>
                        <h4>å®Œæ•´é¡Œç›® (â‰¥4é¸é …)</h4>
                    </div>
                    <div class="result-card">
                        <div class="result-number" style="color: var(--warning-orange);">${incompleteQuestions.length}</div>
                        <h4>ä¸å®Œæ•´é¡Œç›® (<4é¸é …)</h4>
                    </div>
                    <div class="result-card">
                        <div class="result-number" style="color: var(--error-red);">${problemQuestions.length}</div>
                        <h4>å•é¡Œé¡Œç›® (<2é¸é …)</h4>
                    </div>
                </div>
                
                ${problemQuestions.length > 0 ? `
                    <div style="background: var(--light-red); padding: 1.5rem; border-radius: 8px; margin-bottom: 1rem;">
                        <h4 style="color: var(--error-red); margin-bottom: 1rem;">âš ï¸ å•é¡Œé¡Œç›®åˆ—è¡¨</h4>
                        <div style="display: flex; flex-wrap: wrap; gap: 0.5rem;">
                            ${problemQuestions.slice(0, 20).map(q => 
                                `<span style="background: white; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.9rem;">
                                    é¡Œç›®${q.id}
                                </span>`
                            ).join('')}
                            ${problemQuestions.length > 20 ? 
                                `<span style="background: white; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.9rem;">
                                    ...é‚„æœ‰${problemQuestions.length - 20}é“
                                </span>` : ''}
                        </div>
                    </div>
                ` : ''}
                
                <div style="background: var(--gray-50); padding: 1.5rem; border-radius: 8px; font-size: 0.9rem;">
                    <h4 style="margin-bottom: 1rem;">ğŸ’¡ ä½¿ç”¨å»ºè­°</h4>
                    <ul style="line-height: 1.6; margin-left: 1rem;">
                        <li>å•é¡Œé¡Œç›®ä»å¯æ­£å¸¸ä½¿ç”¨ï¼Œä½†å¯èƒ½å½±éŸ¿å­¸ç¿’é«”é©—</li>
                        <li>å»ºè­°ä½¿ç”¨å®Œæ•´æ ¼å¼çš„CSVæ–‡ä»¶ä»¥ç²å¾—æœ€ä½³æ•ˆæœ</li>
                        <li>ç³»çµ±æœƒè‡ªå‹•è·³éæ ¼å¼ä¸æ­£ç¢ºçš„é¸é …</li>
                        <li>å¦‚æœ‰å•é¡Œå¯å˜—è©¦é‡æ–°ä¸Šå‚³CSVæ–‡ä»¶</li>
                    </ul>
                </div>
            `;
            
            debugContainer.innerHTML = debugHtml;
        }

        // ===== è¼‰å…¥çµæœè™•ç† =====
        function handleLoadingResult() {
            if (questions.length >= 400) {
                document.getElementById('upload-section').style.display = 'none';
                showNotification(`ğŸ‰ æˆåŠŸè¼‰å…¥å®Œæ•´ERPé¡Œåº« (${questions.length} é¡Œ)ï¼`, 'success');
            } else if (questions.length > 50) {
                document.getElementById('upload-section').style.display = 'none';
                showNotification(`âœ… è¼‰å…¥ERPé¡Œåº« (${questions.length} é¡Œ)`, 'success');
            } else {
                showNotification(`ğŸ“ ç•¶å‰ç‚ºæ¼”ç¤ºæ¨¡å¼ (${questions.length} é¡Œ)ï¼Œå»ºè­°ä¸Šå‚³å®Œæ•´CSVæ–‡ä»¶`, 'warning');
            }
            
            const savedCount = Object.keys(userAnswers).length;
            const memoryCount = Object.keys(memoryData).length;
            if (savedCount > 0 || memoryCount > 0) {
                setTimeout(() => {
                    showNotification(`ğŸ’¾ å·²æ¢å¾© ${savedCount} é“ç­”é¡Œè¨˜éŒ„ï¼Œ${memoryCount} é“è¨˜æ†¶è¨˜éŒ„`, 'info');
                }, 2000);
            }
        }

        // ===== äº‹ä»¶ç›£è½å™¨ =====
        function bindEventListeners() {
            // è¨˜æ†¶ç‹€æ…‹é»æ“Šäº‹ä»¶
            const memoryStatus = document.getElementById('memory-status');
            if (memoryStatus) {
                memoryStatus.onclick = () => {
                    showPanel('memory');
                };
            }
            
            // éµç›¤å¿«æ·éµ
            document.addEventListener('keydown', handleKeyboardShortcuts);
            
            // çª—å£é—œé–‰å‰ä¿å­˜æ•¸æ“š
            window.addEventListener('beforeunload', () => {
                saveAnswers();
                saveMemoryData();
                saveWrongAnswers();
            });
        }

        function handleKeyboardShortcuts(e) {
            const currentPanel = document.querySelector('.panel.active').id;
            
            if (currentPanel === 'practice-panel') {
                switch(e.key) {
                    case 'ArrowLeft':
                        e.preventDefault();
                        previousQuestion();
                        break;
                    case 'ArrowRight':
                        e.preventDefault();
                        nextQuestion();
                        break;
                    case '1':
                    case '2':
                    case '3':
                    case '4':
                        if (!showingAnswer) {
                            const optionLetter = String.fromCharCode(64 + parseInt(e.key));
                            const optionEl = document.querySelector(`[onclick*="${optionLetter}"]`);
                            if (optionEl) {
                                selectOption(optionLetter, optionEl);
                            }
                        }
                        break;
                    case 'Enter':
                        const submitBtn = document.getElementById('submit-btn');
                        if (submitBtn.style.display !== 'none') {
                            submitAnswer();
                        }
                        break;
                    case 'r':
                    case 'R':
                        if (e.ctrlKey || e.metaKey) return;
                        e.preventDefault();
                        goToRandomQuestion();
                        break;
                }
            } else if (currentPanel === 'memory-panel' && isMemoryPracticing) {
                switch(e.key) {
                    case ' ':
                        e.preventDefault();
                        if (memoryQuestions.length > 0) {
                            flipCard();
                        }
                        break;
                    case '1':
                        if (isCardFlipped) markDifficulty('hard');
                        break;
                    case '2':
                        if (isCardFlipped) markDifficulty('medium');
                        break;
                    case '3':
                        if (isCardFlipped) markDifficulty('easy');
                        break;
                    case '4':
                        if (isCardFlipped) markDifficulty('mastered');
                        break;
                    case 'ArrowRight':
                        e.preventDefault();
                        if (isCardFlipped) nextMemoryCard();
                        break;
                    case 'ArrowLeft':
                        e.preventDefault();
                        if (isCardFlipped) backToQuestion();
                        else previousMemoryCard();
                        break;
                    case 'Escape':
                        exitMemoryPractice();
                        break;
                }
            }
            
            // å…¨å±€å¿«æ·éµ
            if (e.ctrlKey || e.metaKey) {
                switch(e.key) {
                    case '1':
                        e.preventDefault();
                        showPanel('overview');
                        break;
                    case '2':
                        e.preventDefault();
                        showPanel('practice');
                        break;
                    case '3':
                        e.preventDefault();
                        showPanel('browse');
                        break;
                    case '4':
                        e.preventDefault();
                        showPanel('memory');
                        break;
                    case '5':
                        e.preventDefault();
                        showPanel('wrong');
                        break;
                    case '6':
                        e.preventDefault();
                        showPanel('results');
                        break;
                }
            }
        }

        // ===== é é¢åˆå§‹åŒ– =====
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>