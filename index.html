<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ERPè¦åŠƒå¸«åˆ·é¡Œç³»çµ± - å®Œæ•´ç‰ˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-blue: #2563eb;
            --light-blue: #dbeafe;
            --success-green: #059669;
            --light-green: #d1fae5;
            --warning-orange: #d97706;
            --light-orange: #fed7aa;
            --error-red: #dc2626;
            --light-red: #fecaca;
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-600: #4b5563;
            --gray-800: #1f2937;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--light-blue) 0%, var(--gray-50) 100%);
            min-height: 100vh;
            color: var(--gray-800);
        }

        /* Header */
        .header {
            background: white;
            box-shadow: var(--shadow);
            padding: 1rem 0;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary-blue);
        }

        .stats {
            display: flex;
            gap: 2rem;
            font-size: 0.9rem;
        }

        .stat-item {
            text-align: center;
        }

        .stat-number {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--primary-blue);
        }

        /* Main Container */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem 1rem;
        }

        /* Navigation Tabs */
        .nav-tabs {
            display: flex;
            background: white;
            border-radius: 12px;
            padding: 0.5rem;
            margin-bottom: 2rem;
            box-shadow: var(--shadow);
        }

        .nav-tab {
            flex: 1;
            padding: 0.75rem 1rem;
            text-align: center;
            background: transparent;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .nav-tab.active {
            background: var(--primary-blue);
            color: white;
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .nav-tab:hover:not(.active) {
            background: var(--light-blue);
            transform: translateY(-1px);
        }

        /* Content Panels */
        .panel {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .panel.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Question Overview Panel */
        .overview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(60px, 1fr));
            gap: 0.5rem;
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: var(--shadow);
        }

        .question-number {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            font-size: 0.9rem;
            position: relative;
        }

        .question-number:hover {
            transform: scale(1.05);
            box-shadow: var(--shadow);
        }

        .question-number.unanswered {
            background: var(--gray-100);
            border: 2px solid var(--gray-200);
        }

        .question-number.correct {
            background: var(--success-green);
            color: white;
        }

        .question-number.incorrect {
            background: var(--error-red);
            color: white;
        }

        .question-number.current {
            background: var(--primary-blue);
            color: white;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* Question Panel */
        .question-card {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: var(--shadow);
        }

        .question-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--gray-100);
        }

        .question-info {
            display: flex;
            gap: 1rem;
            align-items: center;
            flex-wrap: wrap;
        }

        .question-badge {
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .question-badge.chapter {
            background: var(--light-blue);
            color: var(--primary-blue);
        }

        .question-badge.number {
            background: var(--primary-blue);
            color: white;
        }

        .question-text {
            font-size: 1.1rem;
            line-height: 1.6;
            margin-bottom: 2rem;
            color: var(--gray-800);
        }

        .options {
            display: grid;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .option {
            padding: 1rem 1.5rem;
            border: 2px solid var(--gray-200);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
            display: flex;
            align-items: center;
            font-size: 1rem;
        }

        .option:hover {
            border-color: var(--primary-blue);
            background: var(--light-blue);
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .option.selected {
            border-color: var(--primary-blue);
            background: var(--light-blue);
        }

        .option.correct {
            border-color: var(--success-green);
            background: var(--light-green);
        }

        .option.incorrect {
            border-color: var(--error-red);
            background: var(--light-red);
        }

        .option-letter {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--gray-100);
            margin-right: 1rem;
            font-weight: bold;
            flex-shrink: 0;
        }

        .option.selected .option-letter {
            background: var(--primary-blue);
            color: white;
        }

        .option.correct .option-letter {
            background: var(--success-green);
            color: white;
        }

        .option.incorrect .option-letter {
            background: var(--error-red);
            color: white;
        }

        /* Controls */
        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            font-size: 1rem;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .btn-primary {
            background: var(--primary-blue);
            color: white;
        }

        .btn-success {
            background: var(--success-green);
            color: white;
        }

        .btn-secondary {
            background: var(--gray-200);
            color: var(--gray-800);
        }

        .question-selector {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .question-input {
            padding: 0.5rem;
            border: 2px solid var(--gray-200);
            border-radius: 6px;
            width: 80px;
            text-align: center;
            font-size: 1rem;
        }

        /* Progress Bar */
        .progress-container {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: var(--shadow);
            margin-bottom: 2rem;
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .progress-bar {
            height: 10px;
            background: var(--gray-200);
            border-radius: 5px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-blue), var(--success-green));
            transition: width 0.5s ease;
            border-radius: 5px;
        }

        /* Results Panel */
        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
        }

        .result-card {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: var(--shadow);
            text-align: center;
        }

        .result-number {
            font-size: 3rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .result-number.correct {
            color: var(--success-green);
        }

        .result-number.incorrect {
            color: var(--error-red);
        }

        .result-number.total {
            color: var(--primary-blue);
        }

        /* Browse Panel Styles */
        .browse-item {
            background: var(--gray-50);
            border: 1px solid var(--gray-200);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            transition: all 0.3s ease;
        }

        .browse-item:hover {
            background: white;
            border-color: var(--primary-blue);
            box-shadow: var(--shadow);
        }

        .browse-question-header {
            display: flex;
            justify-content: between;
            align-items: flex-start;
            margin-bottom: 1rem;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .browse-question-number {
            background: var(--primary-blue);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9rem;
            flex-shrink: 0;
        }

        .browse-chapter {
            background: var(--light-blue);
            color: var(--primary-blue);
            padding: 0.25rem 0.75rem;
            border-radius: 15px;
            font-size: 0.8rem;
            flex-shrink: 0;
        }

        .browse-question-text {
            font-size: 1.1rem;
            line-height: 1.6;
            margin-bottom: 1rem;
            color: var(--gray-800);
        }

        .browse-options {
            margin-bottom: 1rem;
        }

        .browse-option {
            padding: 0.5rem 0;
            color: var(--gray-700);
            border-left: 3px solid transparent;
            padding-left: 1rem;
        }

        .browse-option.correct-answer {
            background: var(--light-green);
            border-left-color: var(--success-green);
            font-weight: 500;
            color: var(--success-green);
        }

        .browse-answer {
            background: var(--success-green);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9rem;
            display: inline-block;
        }

        .chapter-filter, #chapter-filter {
            padding: 0.5rem 1rem;
            border: 2px solid var(--gray-200);
            border-radius: 6px;
            background: white;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .chapter-filter:hover, #chapter-filter:hover {
            border-color: var(--primary-blue);
        }

        .chapter-filter:focus, #chapter-filter:focus {
            outline: none;
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.1);
        }

        /* File Upload Styles */
        .file-upload-area {
            border: 2px dashed var(--primary-blue);
            border-radius: 8px;
            padding: 2rem;
            text-align: center;
            background: var(--light-blue);
            transition: all 0.3s ease;
        }

        .file-upload-area:hover {
            border-color: var(--success-green);
            background: var(--light-green);
        }

        .file-upload-area input[type="file"] {
            margin: 1rem 0;
            padding: 0.5rem;
            border: 1px solid var(--gray-200);
            border-radius: 4px;
            background: white;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 1rem;
            }

            .stats {
                gap: 1rem;
            }

            .overview-grid {
                grid-template-columns: repeat(auto-fill, minmax(50px, 1fr));
                gap: 0.3rem;
                padding: 1rem;
            }

            .question-card {
                padding: 1rem;
            }

            .controls {
                flex-direction: column;
                align-items: stretch;
            }

            .question-selector {
                justify-content: center;
            }

            .browse-question-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.5rem;
            }

            .browse-item {
                padding: 1rem;
            }

            .chapter-filter, #chapter-filter {
                width: 100%;
                margin-bottom: 1rem;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <div class="logo">ğŸ“š ERPè¦åŠƒå¸«åˆ·é¡Œç³»çµ± (å®Œæ•´ç‰ˆ)</div>
            <div class="stats">
                <div class="stat-item">
                    <div class="stat-number" id="correctCount">0</div>
                    <div>ç­”å°</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="incorrectCount">0</div>
                    <div>ç­”éŒ¯</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="totalAnswered">0</div>
                    <div>å·²ç­”</div>
                </div>
            </div>
        </div>
    </header>

    <div class="container">
        <nav class="nav-tabs">
            <button class="nav-tab active" onclick="showPanel('overview')">é¡Œåº«ç¸½è¦½</button>
            <button class="nav-tab" onclick="showPanel('practice')">é–‹å§‹åˆ·é¡Œ</button>
            <button class="nav-tab" onclick="showPanel('browse')">é¡Œåº«ç€è¦½</button>
            <button class="nav-tab" onclick="showPanel('results')">ç­”é¡Œçµ±è¨ˆ</button>
        </nav>

        <!-- é¡Œåº«ç¸½è¦½é¢æ¿ -->
        <div id="overview-panel" class="panel active">
            <!-- æ–‡ä»¶ä¸Šå‚³å€åŸŸ -->
            <div class="question-card" id="upload-section">
                <div class="question-header">
                    <h3>ğŸ“ é¡Œåº«æª”æ¡ˆä¸Šå‚³ (å‚™ç”¨é¸é …)</h3>
                </div>
                <div class="file-upload-area">
                    <div>ğŸ“„ ç³»çµ±å·²è‡ªå‹•å˜—è©¦è¼‰å…¥é¡Œåº«ï¼Œå¦‚éœ€æ‰‹å‹•ä¸Šå‚³è«‹é¸æ“‡CSVæ–‡ä»¶</div>
                    <input type="file" id="csv-file-upload" accept=".csv">
                    <div>
                        <button class="btn btn-primary" onclick="uploadCSVFile()">æ‰‹å‹•ä¸Šå‚³CSVé¡Œåº«æ–‡ä»¶</button>
                    </div>
                    <p style="margin-top: 1rem; color: var(--gray-600); font-size: 0.9rem;">
                        <strong>ç³»çµ±æ­£åœ¨è‡ªå‹•è¼‰å…¥å®Œæ•´é¡Œåº«</strong><br>
                        å¦‚æœè‡ªå‹•è¼‰å…¥å¤±æ•—ï¼Œå¯ä½¿ç”¨æ­¤åŠŸèƒ½æ‰‹å‹•ä¸Šå‚³ ERP_Questions.csv æ–‡ä»¶
                    </p>
                </div>
            </div>

            <div class="progress-container">
                <div class="progress-header">
                    <h3>ç­”é¡Œé€²åº¦</h3>
                    <span id="progress-text">0 / 0 (0%)</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill" style="width: 0%"></div>
                </div>
            </div>
            
            <div class="question-card">
                <div class="question-header">
                    <h3>é¡Œåº«ç¸½è¦½ (é»é¸é¡Œè™Ÿé–‹å§‹ä½œç­”)</h3>
                </div>
                <div class="overview-grid" id="overview-grid">
                    <!-- é¡Œç›®ç·¨è™Ÿå°‡ç”±JavaScriptç”Ÿæˆ -->
                </div>
            </div>
        </div>

        <!-- é¡Œåº«ç€è¦½é¢æ¿ -->
        <div id="browse-panel" class="panel">
            <div class="question-card">
                <div class="question-header">
                    <div class="question-info">
                        <h3>ğŸ“– é¡Œåº«ç€è¦½æ¨¡å¼</h3>
                        <span class="question-badge chapter" id="browse-filter">æ‰€æœ‰ç« ç¯€</span>
                    </div>
                    <div>
                        <select id="chapter-filter" onchange="filterByChapter()" class="btn btn-secondary">
                            <option value="">æ‰€æœ‰ç« ç¯€</option>
                        </select>
                    </div>
                </div>
                
                <div id="browse-container" style="max-height: 70vh; overflow-y: auto;">
                    <!-- é¡Œç›®ç€è¦½å…§å®¹å°‡ç”±JavaScriptç”Ÿæˆ -->
                </div>
            </div>
        </div>

        <!-- åˆ·é¡Œé¢æ¿ -->
        <div id="practice-panel" class="panel">
            <div class="question-card">
                <div class="question-header">
                    <div class="question-info">
                        <span class="question-badge number" id="current-question-badge">é¡Œç›® 1</span>
                        <span class="question-badge chapter" id="current-chapter-badge">è¼‰å…¥ä¸­...</span>
                    </div>
                </div>
                
                <div class="question-text" id="question-text">è¼‰å…¥ä¸­...</div>
                
                <div class="options" id="options-container">
                    <!-- é¸é …å°‡ç”±JavaScriptç”Ÿæˆ -->
                </div>
                
                <div class="controls">
                    <div class="question-selector">
                        <label>è·³è‡³é¡Œç›®ï¼š</label>
                        <input type="number" class="question-input" id="question-input" min="1" max="500" placeholder="1">
                        <button class="btn btn-secondary" onclick="goToQuestion()">å‰å¾€</button>
                    </div>
                    
                    <div>
                        <button class="btn btn-secondary" onclick="previousQuestion()" id="prev-btn">ä¸Šä¸€é¡Œ</button>
                        <button class="btn btn-primary" onclick="nextQuestion()" id="next-btn">ä¸‹ä¸€é¡Œ</button>
                        <button class="btn btn-success" onclick="submitAnswer()" id="submit-btn" style="display:none;">ç¢ºèªç­”æ¡ˆ</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ç­”é¡Œçµ±è¨ˆé¢æ¿ -->
        <div id="results-panel" class="panel">
            <div class="results-grid">
                <div class="result-card">
                    <div class="result-number correct" id="result-correct">0</div>
                    <h4>ç­”å°é¡Œæ•¸</h4>
                </div>
                <div class="result-card">
                    <div class="result-number incorrect" id="result-incorrect">0</div>
                    <h4>ç­”éŒ¯é¡Œæ•¸</h4>
                </div>
                <div class="result-card">
                    <div class="result-number total" id="result-total">0</div>
                    <h4>ç¸½ç­”é¡Œæ•¸</h4>
                </div>
                <div class="result-card">
                    <div class="result-number" id="accuracy-rate" style="color: var(--warning-orange);">0%</div>
                    <h4>æ­£ç¢ºç‡</h4>
                </div>
            </div>

            <div class="question-card">
                <h3>éŒ¯é¡Œå›é¡§</h3>
                <div id="incorrect-questions">
                    <p style="text-align: center; color: var(--gray-600); padding: 2rem;">
                        é‚„æ²’æœ‰éŒ¯é¡Œè¨˜éŒ„ï¼Œç¹¼çºŒåŠ æ²¹ï¼ ğŸ’ª
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // é¡Œç›®æ•¸æ“šè¼‰å…¥
        let questions = [];
        let currentQuestionIndex = 0;
        let userAnswers = {}; // å„²å­˜ç”¨æˆ¶ç­”æ¡ˆ
        let showingAnswer = false;

        // åˆå§‹åŒ–
        async function init() {
            // é¡¯ç¤ºè¼‰å…¥æç¤º
            document.getElementById('question-text').textContent = 'æ­£åœ¨è¼‰å…¥ERPé¡Œåº«ï¼Œè«‹ç¨å€™...';
            
            await loadQuestions();
            
            if (questions.length === 0) {
                document.getElementById('question-text').textContent = 'è¼‰å…¥å¤±æ•—ï¼Œè«‹é‡æ–°æ•´ç†é é¢æˆ–æ‰‹å‹•ä¸Šå‚³CSVæ–‡ä»¶ã€‚';
                return;
            }
            
            // åˆå§‹åŒ–æ‰€æœ‰åŠŸèƒ½
            generateOverview();
            generateBrowseContent();
            generateChapterFilter();
            showQuestion(0);
            updateStats();
            
            // æ ¹æ“šè¼‰å…¥çš„é¡Œç›®æ•¸é‡æ±ºå®šé¡¯ç¤ºæ¨¡å¼
            if (questions.length >= 400) {
                // æˆåŠŸè¼‰å…¥å®Œæ•´é¡Œåº«
                document.getElementById('upload-section').style.display = 'none';
                showNotification(`ğŸ‰ æˆåŠŸè¼‰å…¥å®Œæ•´ERPé¡Œåº« (${questions.length} é¡Œ)ï¼`, 'success');
            } else if (questions.length > 50) {
                // è¼‰å…¥äº†éƒ¨åˆ†é¡Œåº«
                document.getElementById('upload-section').style.display = 'none';
                showNotification(`âœ… è¼‰å…¥ERPé¡Œåº« (${questions.length} é¡Œ)`, 'success');
            } else {
                // åªæœ‰æ¼”ç¤ºé¡Œç›®ï¼Œé¡¯ç¤ºä¸Šå‚³å€åŸŸ
                showNotification(`ğŸ“ ç•¶å‰ç‚ºæ¼”ç¤ºæ¨¡å¼ (${questions.length} é¡Œ)ï¼Œå»ºè­°ä¸Šå‚³å®Œæ•´CSVæ–‡ä»¶`, 'success');
            }
        }

        // è¼‰å…¥é¡Œç›®æ•¸æ“š
        async function loadQuestions() {
            try {
                // é¦–å…ˆå˜—è©¦å¾åŒç›®éŒ„è®€å–CSVæ–‡ä»¶ï¼ˆéƒ¨ç½²æ™‚ä½¿ç”¨ï¼‰
                console.log('å˜—è©¦è¼‰å…¥CSVæ–‡ä»¶...');
                const response = await fetch('./ERP_Questions.csv');
                
                if (response.ok) {
                    const csvContent = await response.text();
                    console.log('æˆåŠŸè®€å–CSVæ–‡ä»¶');
                    parseCSVContent(csvContent);
                    
                    if (questions.length > 0) {
                        console.log(`å¾CSVæˆåŠŸè¼‰å…¥ ${questions.length} é“é¡Œç›®`);
                        return;
                    }
                }
                
                // å¦‚æœfetchå¤±æ•—ï¼Œå˜—è©¦ä½¿ç”¨æ–‡ä»¶ç³»çµ±API
                if (window.fs && window.fs.readFile) {
                    console.log('å˜—è©¦ä½¿ç”¨æ–‡ä»¶ç³»çµ±API...');
                    const csvContent = await window.fs.readFile('ERP_Questions.csv', { encoding: 'utf8' });
                    parseCSVContent(csvContent);
                    if (questions.length > 0) {
                        console.log(`å¾æ–‡ä»¶ç³»çµ±æˆåŠŸè¼‰å…¥ ${questions.length} é“é¡Œç›®`);
                        return;
                    }
                }
                
            } catch (error) {
                console.log('è‡ªå‹•è¼‰å…¥å¤±æ•—ï¼Œå°‡ä½¿ç”¨æ¼”ç¤ºæ¨¡å¼:', error.message);
            }
            
            // å¦‚æœæ‰€æœ‰è‡ªå‹•è¼‰å…¥æ–¹å¼éƒ½å¤±æ•—ï¼Œè¼‰å…¥æ¼”ç¤ºé¡Œç›®
            loadSampleQuestions();
        }

        // è§£æCSVå…§å®¹
        function parseCSVContent(csvContent) {
            console.log('é–‹å§‹è§£æCSVå…§å®¹...');
            const lines = csvContent.split('\n').map(line => line.trim()).filter(line => line && line !== 'Content');
            console.log(`CSVç¸½è¡Œæ•¸: ${lines.length}`);
            
            let currentChapter = "";
            const questionLines = [];
            
            // æ‰¾åˆ°æ‰€æœ‰é¡Œç›®è¡Œ
            lines.forEach((line, index) => {
                const match = line.match(/^\(([A-D])\)\s*(\d+)\.\s*(.+)/);
                if (match) {
                    const answer = match[1];
                    const questionId = parseInt(match[2]);
                    const questionText = match[3];
                    
                    if (questionId >= 1 && questionId <= 500) {
                        questionLines.push({
                            lineIndex: index,
                            questionId: questionId,
                            answer: answer,
                            questionText: questionText,
                            fullLine: line
                        });
                    }
                }
            });
            
            console.log(`æ‰¾åˆ° ${questionLines.length} é“é¡Œç›®è¡Œ`);
            
            // æŒ‰é¡Œç›®IDæ’åº
            questionLines.sort((a, b) => a.questionId - b.questionId);
            
            // ç‚ºæ¯é“é¡Œç›®æ”¶é›†é¸é …å’Œç« ç¯€ä¿¡æ¯
            let processedCount = 0;
            for (let i = 0; i < questionLines.length; i++) {
                const currentQ = questionLines[i];
                const nextQ = questionLines[i + 1];
                
                let questionText = currentQ.questionText;
                let options = [];
                
                // åœ¨ç•¶å‰é¡Œç›®ä¹‹å‰æŸ¥æ‰¾ç« ç¯€ä¿¡æ¯
                for (let k = currentQ.lineIndex - 1; k >= 0; k--) {
                    const prevLine = lines[k];
                    if (prevLine.includes("ç¬¬") && prevLine.includes("ç« ")) {
                        currentChapter = prevLine.replace(/\d+ä¸­è¯ä¼æ¥­è³‡æºè¦åŠƒå­¸æœƒ å°ˆæ¥­èªè­‰/, '').trim();
                        break;
                    }
                    if (k === 0 || lines[k].match(/^\([A-D]\)\s*\d+\./)) {
                        break;
                    }
                }
                
                // æ”¶é›†é¸é … - æ”¹é€²ç‰ˆæœ¬
                const startIndex = currentQ.lineIndex + 1;
                const endIndex = nextQ ? nextQ.lineIndex : lines.length;
                let optionCollectionPhase = true;
                
                for (let j = startIndex; j < endIndex && optionCollectionPhase; j++) {
                    const line = lines[j];
                    
                    // è·³éæ¨™é¡Œè¡Œå’Œç« ç¯€è¡Œ
                    if (line.includes("ERP è¦åŠƒå¸«") || 
                        line.includes("è©¦ é¡Œ æŒ‡ å—") || 
                        line.includes("ERPè¦åŠƒå¸«-åƒè€ƒé¡Œå‹") ||
                        line.includes("ä¸­è¯ä¼æ¥­è³‡æºè¦åŠƒå­¸æœƒ") ||
                        (line.includes("ç¬¬") && line.includes("ç« "))) {
                        continue;
                    }
                    
                    // æª¢æŸ¥é¸é …æ ¼å¼ - æ›´å¯¬é¬†çš„åŒ¹é…
                    if (line.match(/^\([A-D]\)/)) {
                        // å¦‚æœæ˜¯ä¸‹ä¸€é¡Œçš„é¡Œç›®è¡Œï¼Œåœæ­¢æ”¶é›†é¸é …
                        if (line.match(/^\([A-D]\)\s*\d+\./)) {
                            optionCollectionPhase = false;
                            break;
                        } else {
                            // é€™æ˜¯é¸é …è¡Œ
                            options.push(line);
                        }
                    } else if (options.length === 0 && !line.match(/^\([A-D]\)/)) {
                        // å¦‚æœé‚„æ²’é–‹å§‹æ”¶é›†é¸é …ä¸”é€™ä¸æ˜¯é¸é …è¡Œï¼Œå¯èƒ½æ˜¯é¡Œç›®å…§å®¹å»¶çºŒ
                        questionText += " " + line;
                    }
                }
                
                // ç¢ºä¿è‡³å°‘æœ‰2å€‹é¸é …çš„é¡Œç›®æ‰åŠ å…¥
                if (options.length >= 2) {
                    questions.push({
                        id: currentQ.questionId,
                        question: questionText.trim(),
                        answer: currentQ.answer,
                        options: options,
                        chapter: currentChapter || "ç¬¬ 1 ç«  ä¼æ¥­è³‡æºè¦åŠƒç°¡ä»‹"
                    });
                    processedCount++;
                } else {
                    console.log(`é¡Œç›® ${currentQ.questionId} é¸é …ä¸è¶³ (${options.length} å€‹):`, options);
                }
            }
            
            // æŒ‰é¡Œç›®ç·¨è™Ÿæ’åº
            questions.sort((a, b) => a.id - b.id);
            console.log(`CSVè§£æå®Œæˆï¼ŒæˆåŠŸè™•ç† ${processedCount} é“é¡Œç›®`);
        }

        // ç”Ÿæˆé¡Œåº«ç€è¦½å…§å®¹
        function generateBrowseContent(filteredQuestions = null) {
            const container = document.getElementById('browse-container');
            const questionsToShow = filteredQuestions || questions;
            
            if (questionsToShow.length === 0) {
                container.innerHTML = '<p style="text-align: center; padding: 2rem; color: var(--gray-600);">æ²’æœ‰æ‰¾åˆ°ç¬¦åˆæ¢ä»¶çš„é¡Œç›®</p>';
                return;
            }
            
            container.innerHTML = questionsToShow.map(q => {
                const optionsHtml = q.options.map(option => {
                    const optionLetter = option.match(/^\(([A-D])\)/)[1];
                    const optionText = option.replace(/^\([A-D]\)\s*/, '');
                    const isCorrect = optionLetter === q.answer;
                    
                    return `
                        <div class="browse-option ${isCorrect ? 'correct-answer' : ''}">
                            <strong>${optionLetter})</strong> ${optionText}
                            ${isCorrect ? ' âœ“' : ''}
                        </div>
                    `;
                }).join('');
                
                return `
                    <div class="browse-item">
                        <div class="browse-question-header">
                            <div style="display: flex; gap: 1rem; align-items: center; flex-wrap: wrap;">
                                <div class="browse-question-number">é¡Œç›® ${q.id}</div>
                                <div class="browse-chapter">${q.chapter}</div>
                            </div>
                            <div class="browse-answer">ç­”æ¡ˆ: ${q.answer}</div>
                        </div>
                        
                        <div class="browse-question-text">${q.question}</div>
                        
                        <div class="browse-options">
                            ${optionsHtml}
                        </div>
                    </div>
                `;
            }).join('');
        }

        // ç”Ÿæˆç« ç¯€ç¯©é¸é¸é …
        function generateChapterFilter() {
            const select = document.getElementById('chapter-filter');
            const chapters = [...new Set(questions.map(q => q.chapter))].sort();
            
            select.innerHTML = '<option value="">æ‰€æœ‰ç« ç¯€</option>' + 
                chapters.map(chapter => `<option value="${chapter}">${chapter}</option>`).join('');
        }

        // æŒ‰ç« ç¯€ç¯©é¸
        function filterByChapter() {
            const selectedChapter = document.getElementById('chapter-filter').value;
            const filterBadge = document.getElementById('browse-filter');
            
            if (selectedChapter) {
                const filteredQuestions = questions.filter(q => q.chapter === selectedChapter);
                generateBrowseContent(filteredQuestions);
                filterBadge.textContent = selectedChapter;
            } else {
                generateBrowseContent();
                filterBadge.textContent = 'æ‰€æœ‰ç« ç¯€';
            }
        }
        function uploadCSVFile() {
            const fileInput = document.getElementById('csv-file-upload');
            const file = fileInput.files[0];
            
            if (!file) {
                alert('è«‹å…ˆé¸æ“‡CSVæ–‡ä»¶ï¼');
                return;
            }
            
            if (!file.name.toLowerCase().endsWith('.csv')) {
                alert('è«‹é¸æ“‡CSVæ ¼å¼çš„æ–‡ä»¶ï¼');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const csvContent = e.target.result;
                
                // æ¸…ç©ºç¾æœ‰é¡Œç›®
                questions = [];
                userAnswers = {};
                
                // è§£ææ–°çš„CSVå…§å®¹
                parseCSVContent(csvContent);
                
                if (questions.length > 0) {
                    // é‡æ–°åˆå§‹åŒ–ç•Œé¢
                    generateOverview();
                    updateStats();
                    showQuestion(0);
                    
                    // éš±è—ä¸Šå‚³å€åŸŸ
                    document.getElementById('upload-section').style.display = 'none';
                    
                    showNotification(`æˆåŠŸè¼‰å…¥ ${questions.length} é“é¡Œç›®ï¼ğŸ‰`, 'success');
                } else {
                    showNotification('CSVæ–‡ä»¶æ ¼å¼ä¸æ­£ç¢ºï¼Œè«‹æª¢æŸ¥æ–‡ä»¶å…§å®¹ï¼âŒ', 'error');
                }
            };
            
            reader.onerror = function() {
                showNotification('æ–‡ä»¶è®€å–å¤±æ•—ï¼Œè«‹é‡è©¦ï¼âŒ', 'error');
            };
            
            reader.readAsText(file, 'UTF-8');
        }

        // è¼‰å…¥ç¤ºä¾‹é¡Œç›®ï¼ˆç•¶ç„¡æ³•è®€å–CSVæ™‚ä½¿ç”¨ï¼‰
        function loadSampleQuestions() {
            questions = [
                {
                    id: 1,
                    question: "ERP ç³»çµ±æœ€æ–°çš„ä¸»æµè¶¨å‹¢æ˜¯æ¡ç”¨ä¸‹åˆ—å“ªä¸€ç¨®åŸºæœ¬æŠ€è¡“æ¶æ§‹",
                    answer: "D",
                    options: [
                        "(A) é›†ä¸­å¼æ¶æ§‹",
                        "(B) åˆ†æ•£å¼æ¶æ§‹", 
                        "(C) åŒå„•è¨ˆç®—æ¶æ§‹",
                        "(D) å¤šå±¤å¼(Multi-tier)ä¸»å¾æ¶æ§‹"
                    ],
                    chapter: "ç¬¬ 1 ç«  ä¼æ¥­è³‡æºè¦åŠƒç°¡ä»‹"
                },
                {
                    id: 2,
                    question: "ERP ç³»çµ±èƒ½å³æ™‚æ•´åˆå„æµç¨‹è³‡æ–™çš„åŸå› ç‚º",
                    answer: "A",
                    options: [
                        "(A) å„æµç¨‹è³‡æ–™å„²å­˜æ–¼åŒä¸€è³‡æ–™åº«ä¸­",
                        "(B) å¿«é€Ÿçš„é›»è…¦é‹ç®—",
                        "(C) é›»å­å•†å‹™çš„ç››è¡Œ", 
                        "(D) æ”¿åºœé¼“å‹µ"
                    ],
                    chapter: "ç¬¬ 1 ç«  ä¼æ¥­è³‡æºè¦åŠƒç°¡ä»‹"
                },
                {
                    id: 11,
                    question: "åœ¨éŠ·å”®èˆ‡é…éŠ·æ¨¡çµ„ä¸­ï¼Œä¸‹åˆ—ä½•è€…ç‚ºä¼æ¥­å¾äº‹è¡ŒéŠ·ä½œæ¥­(Marketing Activity)æ™‚ï¼Œæœ€å¸¸ç”¨è€Œä¸”ç‚ºæœ€æœ‰æ•ˆçš„æ–¹å¼",
                    answer: "A",
                    options: [
                        "(A) ç›´æ•ˆéƒµé (Direct Mailing, DM)",
                        "(B) ç ”è¨æœƒ",
                        "(C) éŠ·å”®é›»è©±",
                        "(D) éŠ·å”®è¬›åº§"
                    ],
                    chapter: "ç¬¬ 3 ç«  éŠ·å”®èˆ‡é…éŠ·æ¨¡çµ„"
                },
                {
                    id: 78,
                    question: "ä»¥ä¸‹ä½•è€…ä¸æ˜¯ç”Ÿç”¢è¦åŠƒçš„ç›®çš„",
                    answer: "A",
                    options: [
                        "(A) å¢åŠ ç”¢å“ç¨®é¡",
                        "(B) é™ä½ç”Ÿç”¢æˆæœ¬",
                        "(C) æé«˜ç”Ÿç”¢æ•ˆç‡",
                        "(D) ç¢ºä¿äº¤æœŸæº–ç¢º"
                    ],
                    chapter: "ç¬¬ 4 ç«  ç”Ÿç”¢è¦åŠƒèˆ‡æ§åˆ¶"
                },
                {
                    id: 133,
                    question: "ä¸‹åˆ—ä½•è€…ä¸æ˜¯å½±éŸ¿ä¼æ¥­æ¡è³¼ç™¼å±•è¶¨å‹¢çš„å› ç´ ",
                    answer: "A",
                    options: [
                        "(A) ä¼æ¥­çµ„ç¹”è¦æ¨¡æ“´å¤§",
                        "(B) å…¨çƒç«¶çˆ­åŠ åŠ‡",
                        "(C) è³‡è¨Šç§‘æŠ€ç™¼é”",
                        "(D) ä¾›æ‡‰å•†ç­–ç•¥è¯ç›Ÿ"
                    ],
                    chapter: "ç¬¬ 5 ç«  ä¼æ¥­ä¹‹æ¡è³¼ç®¡ç†"
                },
                {
                    id: 186,
                    question: "åœ¨åº«å­˜ç®¡ç†ç³»çµ±ä¸­ï¼ŒABC åˆ†ææ³•æ˜¯åˆ©ç”¨ä½•ç¨®æ³•å‰‡ç™¼å±•å‡ºä¾†çš„å­˜è²¨åˆ†é¡æ–¹æ³•",
                    answer: "C",
                    options: [
                        "(A) ç¶“æ¿Ÿè¨‚è³¼æ‰¹é‡æ³•å‰‡",
                        "(B) å®‰å…¨å­˜é‡æ³•å‰‡",
                        "(C) æŸæ‹‰åœ– 80-20 æ³•å‰‡",
                        "(D) å†è¨‚è³¼é»æ³•å‰‡"
                    ],
                    chapter: "ç¬¬ 6 ç«  åº«å­˜ç®¡ç†ç³»çµ±"
                },
                {
                    id: 269,
                    question: "è²¡å‹™æœƒè¨ˆä½œæ¥­çš„ä¸»è¦ç›®çš„ç‚º",
                    answer: "B",
                    options: [
                        "(A) å…§éƒ¨ç®¡ç†æ±ºç­–",
                        "(B) å°å¤–è²¡å‹™å ±å‘Š",
                        "(C) æˆæœ¬æ§åˆ¶åˆ†æ",
                        "(D) é ç®—ç·¨åˆ¶è¦åŠƒ"
                    ],
                    chapter: "ç¬¬ 7 ç«  ERP è²¡å‹™æœƒè¨ˆæ¨¡çµ„"
                },
                {
                    id: 310,
                    question: "åœ¨æˆæœ¬æ§åˆ¶æ¨¡çµ„ä¸­ï¼Œä¸‹åˆ—ä½•è€…å±¬æ–¼è®Šå‹•æˆæœ¬",
                    answer: "A",
                    options: [
                        "(A) ç›´æ¥ææ–™æˆæœ¬",
                        "(B) å» æˆ¿æŠ˜èˆŠè²»ç”¨",
                        "(C) ç®¡ç†äººå“¡è–ªè³‡",
                        "(D) è¨­å‚™ç§Ÿè³ƒè²»ç”¨"
                    ],
                    chapter: "ç¬¬ 8 ç«  æˆæœ¬æ§åˆ¶æ¨¡çµ„"
                },
                {
                    id: 360,
                    question: "äººåŠ›è³‡æºç®¡ç†æ¨¡çµ„çš„ä¸»è¦åŠŸèƒ½ä¸åŒ…æ‹¬",
                    answer: "D",
                    options: [
                        "(A) æ‹›å‹Ÿèˆ‡ç”„é¸",
                        "(B) è¨“ç·´èˆ‡ç™¼å±•",
                        "(C) è–ªè³‡ç®¡ç†",
                        "(D) ç”¢å“è¨­è¨ˆ"
                    ],
                    chapter: "ç¬¬ 9 ç«  äººåŠ›è³‡æºæ¨¡çµ„"
                },
                {
                    id: 394,
                    question: "ERP ç³»çµ±å°å…¥éç¨‹ä¸­ï¼Œæœ€é‡è¦çš„æˆåŠŸå› ç´ ç‚º",
                    answer: "B",
                    options: [
                        "(A) æŠ€è¡“å…ˆé€²æ€§",
                        "(B) é«˜éšä¸»ç®¡æ”¯æŒ",
                        "(C) ç³»çµ±åŠŸèƒ½å®Œæ•´",
                        "(D) æˆæœ¬æ§åˆ¶åš´æ ¼"
                    ],
                    chapter: "ç¬¬ 11 ç«  ç³»çµ±å°å…¥"
                },
                {
                    id: 408,
                    question: "é›²ç«¯é‹ç®—å…·æœ‰ä¸‹åˆ—å“ªäº›åŸºæœ¬ç‰¹æ€§",
                    answer: "A",
                    options: [
                        "(A) éš¨é¸å³ç”¨çš„è‡ªåŠ©æœå‹™",
                        "(B) å›ºå®šçš„è³‡æºé…ç½®",
                        "(C) å–®ä¸€å­˜å–æ–¹å¼",
                        "(D) äººå·¥è³‡æºç®¡ç†"
                    ],
                    chapter: "ç¬¬ 14 ç«  ä¼æ¥­é›²ç«¯é‹ç®—èˆ‡æ‡‰ç”¨"
                },
                {
                    id: 433,
                    question: "ERP ç³»çµ±å¿…é ˆå»ºç½®åœ¨ä¸€å¥—ç©©å®šçš„è³‡æ–™åº«ç³»çµ±ä¹‹ä¸Šï¼Œä¸‹åˆ—ä½•è€…ä¸æ˜¯è³‡æ–™åº«è»Ÿé«”",
                    answer: "B",
                    options: [
                        "(A) Oracle",
                        "(B) Windows",
                        "(C) SQL Server",
                        "(D) MySQL"
                    ],
                    chapter: "ç¬¬ 16 ç«  è³‡æ–™åº«ç®¡ç†èˆ‡ ERP ç³»çµ±"
                }
            ];
            console.log(`è¼‰å…¥äº† ${questions.length} é“ç¤ºä¾‹é¡Œç›®ï¼ˆæ¼”ç¤ºæ¨¡å¼ - æ¶µè“‹å„ä¸»è¦ç« ç¯€ï¼‰`);
        }

        // ç”Ÿæˆé¡Œåº«ç¸½è¦½ç¶²æ ¼
        function generateOverview() {
            const grid = document.getElementById('overview-grid');
            grid.innerHTML = '';
            
            // æ›´æ–°è¼¸å…¥æ¡†æœ€å¤§å€¼
            const questionInput = document.getElementById('question-input');
            if (questions.length > 0) {
                const maxId = Math.max(...questions.map(q => q.id));
                questionInput.max = maxId;
            }
            
            questions.forEach(q => {
                const numberEl = document.createElement('div');
                numberEl.className = 'question-number unanswered';
                numberEl.textContent = q.id;
                numberEl.onclick = () => {
                    currentQuestionIndex = questions.findIndex(question => question.id === q.id);
                    showPanel('practice');
                    showQuestion(currentQuestionIndex);
                };
                
                // æ ¹æ“šç­”é¡Œç‹€æ…‹è¨­ç½®æ¨£å¼
                if (userAnswers[q.id]) {
                    if (userAnswers[q.id] === q.answer) {
                        numberEl.className = 'question-number correct';
                    } else {
                        numberEl.className = 'question-number incorrect';
                    }
                }
                
                grid.appendChild(numberEl);
            });
        }

        // é¡¯ç¤ºæŒ‡å®šé¡Œç›®
        function showQuestion(index) {
            if (index < 0 || index >= questions.length) return;
            
            currentQuestionIndex = index;
            const question = questions[index];
            showingAnswer = false;
            
            // æ›´æ–°é¡Œç›®ä¿¡æ¯
            document.getElementById('current-question-badge').textContent = `é¡Œç›® ${question.id}`;
            document.getElementById('current-chapter-badge').textContent = question.chapter;
            document.getElementById('question-text').textContent = question.question;
            document.getElementById('question-input').value = question.id;
            
            // ç”Ÿæˆé¸é …
            const optionsContainer = document.getElementById('options-container');
            optionsContainer.innerHTML = '';
            
            question.options.forEach((option, i) => {
                const optionEl = document.createElement('div');
                optionEl.className = 'option';
                
                const letter = option.match(/^\(([A-D])\)/)[1];
                const text = option.replace(/^\([A-D]\)\s*/, '');
                
                optionEl.innerHTML = `
                    <div class="option-letter">${letter}</div>
                    <div>${text}</div>
                `;
                
                optionEl.onclick = () => selectOption(letter, optionEl);
                optionsContainer.appendChild(optionEl);
            });
            
            // å¦‚æœå·²ç¶“ç­”éï¼Œé¡¯ç¤ºä¹‹å‰çš„é¸æ“‡
            if (userAnswers[question.id]) {
                const selectedOption = optionsContainer.querySelector(`[onclick*="${userAnswers[question.id]}"]`);
                if (selectedOption) {
                    selectedOption.classList.add('selected');
                }
            }
            
            // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
            updateButtonStates();
            
            // æ¨™è¨˜ç•¶å‰é¡Œç›®
            updateOverviewHighlight();
        }

        // é¸æ“‡é¸é …
        function selectOption(letter, element) {
            if (showingAnswer) return;
            
            // æ¸…é™¤æ‰€æœ‰é¸ä¸­ç‹€æ…‹
            document.querySelectorAll('.option').forEach(opt => {
                opt.classList.remove('selected');
            });
            
            // è¨­ç½®ç•¶å‰é¸ä¸­
            element.classList.add('selected');
            
            // é¡¯ç¤ºç¢ºèªæŒ‰éˆ•
            document.getElementById('submit-btn').style.display = 'inline-block';
            document.getElementById('next-btn').style.display = 'none';
        }

        // æäº¤ç­”æ¡ˆ
        function submitAnswer() {
            const question = questions[currentQuestionIndex];
            const selectedOption = document.querySelector('.option.selected');
            
            if (!selectedOption) return;
            
            const userAnswer = selectedOption.querySelector('.option-letter').textContent;
            userAnswers[question.id] = userAnswer;
            
            // é¡¯ç¤ºæ­£ç¢ºç­”æ¡ˆ
            showingAnswer = true;
            const options = document.querySelectorAll('.option');
            
            options.forEach(opt => {
                const letter = opt.querySelector('.option-letter').textContent;
                if (letter === question.answer) {
                    opt.classList.add('correct');
                } else if (letter === userAnswer && letter !== question.answer) {
                    opt.classList.add('incorrect');
                }
            });
            
            // æ›´æ–°æŒ‰éˆ•
            document.getElementById('submit-btn').style.display = 'none';
            document.getElementById('next-btn').style.display = 'inline-block';
            
            // æ›´æ–°çµ±è¨ˆ
            updateStats();
            generateOverview();
            updateResults();
            
            // çµ¦å‡ºè¦–è¦ºåé¥‹
            if (userAnswer === question.answer) {
                showNotification('æ­£ç¢ºï¼âœ…', 'success');
            } else {
                showNotification('éŒ¯èª¤ï¼âŒ', 'error');
            }
        }

        // é¡¯ç¤ºé€šçŸ¥
        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 100px;
                right: 20px;
                padding: 1rem 2rem;
                border-radius: 8px;
                color: white;
                font-weight: bold;
                z-index: 1000;
                animation: slideIn 0.3s ease;
                ${type === 'success' ? 'background: var(--success-green);' : 'background: var(--error-red);'}
            `;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            setTimeout(() => {
                notification.remove();
            }, 2000);
        }

        // ä¸Šä¸€é¡Œ
        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                showQuestion(currentQuestionIndex - 1);
            }
        }

        // ä¸‹ä¸€é¡Œ
        function nextQuestion() {
            if (currentQuestionIndex < questions.length - 1) {
                showQuestion(currentQuestionIndex + 1);
            }
        }

        // è·³è‡³æŒ‡å®šé¡Œç›®
        function goToQuestion() {
            const questionId = parseInt(document.getElementById('question-input').value);
            const index = questions.findIndex(q => q.id === questionId);
            
            if (index !== -1) {
                showQuestion(index);
            } else {
                alert('é¡Œç›®ç·¨è™Ÿä¸å­˜åœ¨ï¼');
            }
        }

        // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
        function updateButtonStates() {
            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');
            
            prevBtn.disabled = currentQuestionIndex === 0;
            nextBtn.disabled = currentQuestionIndex === questions.length - 1;
            
            prevBtn.style.opacity = prevBtn.disabled ? '0.5' : '1';
            nextBtn.style.opacity = nextBtn.disabled ? '0.5' : '1';
        }

        // æ›´æ–°ç¸½è¦½é«˜äº®
        function updateOverviewHighlight() {
            document.querySelectorAll('.question-number').forEach(el => {
                el.classList.remove('current');
            });
            
            const currentEl = document.querySelector(`[onclick*="${questions[currentQuestionIndex].id}"]`);
            if (currentEl) {
                currentEl.classList.add('current');
            }
        }

        // æ›´æ–°çµ±è¨ˆä¿¡æ¯
        function updateStats() {
            const answered = Object.keys(userAnswers).length;
            const correct = Object.entries(userAnswers).filter(([id, answer]) => {
                const question = questions.find(q => q.id == id);
                return question && question.answer === answer;
            }).length;
            const incorrect = answered - correct;
            
            document.getElementById('correctCount').textContent = correct;
            document.getElementById('incorrectCount').textContent = incorrect;
            document.getElementById('totalAnswered').textContent = answered;
            
            // æ›´æ–°é€²åº¦æ¢
            const totalQuestions = questions.length;
            const progressPercent = totalQuestions > 0 ? (answered / totalQuestions) * 100 : 0;
            document.getElementById('progress-fill').style.width = `${progressPercent}%`;
            document.getElementById('progress-text').textContent = `${answered} / ${totalQuestions} (${Math.round(progressPercent)}%)`;
        }

        // æ›´æ–°çµæœé¢æ¿
        function updateResults() {
            const answered = Object.keys(userAnswers).length;
            const correct = Object.entries(userAnswers).filter(([id, answer]) => {
                const question = questions.find(q => q.id == id);
                return question && question.answer === answer;
            }).length;
            const incorrect = answered - correct;
            const accuracy = answered > 0 ? Math.round((correct / answered) * 100) : 0;
            
            document.getElementById('result-correct').textContent = correct;
            document.getElementById('result-incorrect').textContent = incorrect;
            document.getElementById('result-total').textContent = answered;
            document.getElementById('accuracy-rate').textContent = `${accuracy}%`;
            
            // æ›´æ–°éŒ¯é¡Œåˆ—è¡¨
            const incorrectContainer = document.getElementById('incorrect-questions');
            const incorrectQuestions = Object.entries(userAnswers).filter(([id, answer]) => {
                const question = questions.find(q => q.id == id);
                return question && question.answer !== answer;
            });
            
            if (incorrectQuestions.length === 0) {
                incorrectContainer.innerHTML = '<p style="text-align: center; color: var(--gray-600); padding: 2rem;">é‚„æ²’æœ‰éŒ¯é¡Œè¨˜éŒ„ï¼Œç¹¼çºŒåŠ æ²¹ï¼ ğŸ’ª</p>';
            } else {
                incorrectContainer.innerHTML = incorrectQuestions.map(([id, userAnswer]) => {
                    const question = questions.find(q => q.id == id);
                    return `
                        <div style="border: 1px solid var(--gray-200); border-radius: 8px; padding: 1rem; margin-bottom: 1rem;">
                            <strong>é¡Œç›® ${id}:</strong> ${question.question}<br>
                            <span style="color: var(--error-red);">ä½ çš„ç­”æ¡ˆ: ${userAnswer}</span><br>
                            <span style="color: var(--success-green);">æ­£ç¢ºç­”æ¡ˆ: ${question.answer}</span>
                        </div>
                    `;
                }).join('');
            }
        }

        // é¢æ¿åˆ‡æ›
        function showPanel(panelName) {
            // éš±è—æ‰€æœ‰é¢æ¿
            document.querySelectorAll('.panel').forEach(panel => {
                panel.classList.remove('active');
            });
            
            // ç§»é™¤æ‰€æœ‰æ¨™ç±¤çš„æ¿€æ´»ç‹€æ…‹
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // é¡¯ç¤ºæŒ‡å®šé¢æ¿
            document.getElementById(`${panelName}-panel`).classList.add('active');
            
            // æ¿€æ´»å°æ‡‰æ¨™ç±¤
            event.target.classList.add('active');
            
            // å¦‚æœåˆ‡æ›åˆ°ç€è¦½é¢æ¿ä¸”é‚„æ²’ç”Ÿæˆå…§å®¹ï¼Œé‡æ–°ç”Ÿæˆ
            if (panelName === 'browse' && document.getElementById('browse-container').innerHTML === '') {
                generateBrowseContent();
                generateChapterFilter();
            }
        }

        // éµç›¤å¿«æ·éµ
        document.addEventListener('keydown', (e) => {
            if (document.getElementById('practice-panel').classList.contains('active')) {
                switch(e.key) {
                    case 'ArrowLeft':
                        e.preventDefault();
                        previousQuestion();
                        break;
                    case 'ArrowRight':
                        e.preventDefault();
                        nextQuestion();
                        break;
                    case '1':
                    case '2':
                    case '3':
                    case '4':
                        if (!showingAnswer) {
                            const optionLetter = String.fromCharCode(64 + parseInt(e.key)); // 1->A, 2->B, etc.
                            const optionEl = document.querySelector(`[onclick*="${optionLetter}"]`);
                            if (optionEl) {
                                selectOption(optionLetter, optionEl);
                            }
                        }
                        break;
                    case 'Enter':
                        if (document.getElementById('submit-btn').style.display !== 'none') {
                            submitAnswer();
                        }
                        break;
                }
            }
        });

        // é é¢è¼‰å…¥å®Œæˆå¾Œåˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>